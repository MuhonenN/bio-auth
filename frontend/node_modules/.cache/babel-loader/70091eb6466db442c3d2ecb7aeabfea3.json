{"ast":null,"code":"var K = Object.defineProperty;\nvar B = Object.getOwnPropertySymbols;\nvar $ = Object.prototype.hasOwnProperty,\n    W = Object.prototype.propertyIsEnumerable;\n\nvar F = (s, e, t) => e in s ? K(s, e, {\n  enumerable: !0,\n  configurable: !0,\n  writable: !0,\n  value: t\n}) : s[e] = t,\n    J = (s, e) => {\n  for (var t in e || (e = {})) $.call(e, t) && F(s, t, e[t]);\n\n  if (B) for (var t of B(e)) W.call(e, t) && F(s, t, e[t]);\n  return s;\n};\n\nvar q = (s, e, t) => {\n  if (!e.has(s)) throw TypeError(\"Cannot \" + t);\n};\n\nvar d = (s, e, t) => (q(s, e, \"read from private field\"), t ? t.call(s) : e.get(s)),\n    S = (s, e, t) => {\n  if (e.has(s)) throw TypeError(\"Cannot add the same private member more than once\");\n  e instanceof WeakSet ? e.add(s) : e.set(s, t);\n},\n    _ = (s, e, t, n) => (q(s, e, \"write to private field\"), n ? n.call(s, t) : e.set(s, t), t);\n\nvar l = class {\n  encodeBytes(e) {\n    return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n  }\n\n  decodeBytes(e) {\n    let t = e.replace(/-/g, \"+\").replace(/_/g, \"/\").replace(/=+$/, \"\");\n    return Uint8Array.from(atob(t), a => a.charCodeAt(0));\n  }\n\n};\n\nvar r = class extends Error {\n  constructor(e, t) {\n    super();\n    this.name = \"PassageError\", this.statusCode = t.status, this.statusText = t.statusText, this.message = this._parsePsgErrorResponse(e);\n  }\n\n  _parsePsgErrorResponse(e) {\n    try {\n      return e = JSON.parse(e), e.error ? e.error : \"\";\n    } catch {\n      return e;\n    }\n  }\n\n},\n    y = (i => (i[i.MultipleChoice = 300] = \"MultipleChoice\", i[i.MovedPermanantly = 301] = \"MovedPermanantly\", i[i.Found = 302] = \"Found\", i[i.SeeOther = 303] = \"SeeOther\", i[i.NotModified = 304] = \"NotModified\", i[i.TemporaryRedirect = 307] = \"TemporaryRedirect\", i[i.PermanentRedirect = 308] = \"PermanentRedirect\", i[i.BadRequest = 400] = \"BadRequest\", i[i.Unauthorized = 401] = \"Unauthorized\", i[i.PaymentRequired = 402] = \"PaymentRequired\", i[i.Forbidden = 403] = \"Forbidden\", i[i.NotFound = 404] = \"NotFound\", i[i.MethodNotAllowed = 405] = \"MethodNotAllowed\", i[i.NotAcceptable = 406] = \"NotAcceptable\", i[i.ProxyAuthenticationRequired = 407] = \"ProxyAuthenticationRequired\", i[i.RequestTimeout = 408] = \"RequestTimeout\", i[i.Conflict = 409] = \"Conflict\", i[i.Gone = 410] = \"Gone\", i[i.LengthRequired = 411] = \"LengthRequired\", i[i.PreconditionFailed = 412] = \"PreconditionFailed\", i[i.PayloadTooLarge = 413] = \"PayloadTooLarge\", i[i.URITooLong = 414] = \"URITooLong\", i[i.UnsupportedMediaType = 415] = \"UnsupportedMediaType\", i[i.RangeNotSatisfiable = 416] = \"RangeNotSatisfiable\", i[i.ExpectationFailed = 417] = \"ExpectationFailed\", i[i.MisdirectedRequest = 421] = \"MisdirectedRequest\", i[i.UnprocessableEntity = 422] = \"UnprocessableEntity\", i[i.Locked = 423] = \"Locked\", i[i.FailedDependency = 424] = \"FailedDependency\", i[i.TooEarly = 425] = \"TooEarly\", i[i.UpgradeRequired = 426] = \"UpgradeRequired\", i[i.PreconditionRequired = 428] = \"PreconditionRequired\", i[i.TooManyRequests = 429] = \"TooManyRequests\", i[i.RequestHeaderFieldsTooLarge = 431] = \"RequestHeaderFieldsTooLarge\", i[i.UnavailableForLegalReasons = 451] = \"UnavailableForLegalReasons\", i[i.InternalServerError = 500] = \"InternalServerError\", i[i.NotImplemented = 501] = \"NotImplemented\", i[i.BadGateway = 502] = \"BadGateway\", i[i.ServiceUnavailable = 503] = \"ServiceUnavailable\", i[i.GatewayTimeout = 504] = \"GatewayTimeout\", i[i.HTTPVersionNotSupported = 505] = \"HTTPVersionNotSupported\", i[i.VariantAlsoNegotiates = 506] = \"VariantAlsoNegotiates\", i[i.InsufficientStorage = 507] = \"InsufficientStorage\", i[i.LoopDetected = 508] = \"LoopDetected\", i[i.NotExtended = 510] = \"NotExtended\", i[i.NetworkAuthenticationRequired = 511] = \"NetworkAuthenticationRequired\", i[i.PSGCredObjectDoesNotExist = 700] = \"PSGCredObjectDoesNotExist\", i[i.PSGParsePublicKeyForNewDeviceFailed = 701] = \"PSGParsePublicKeyForNewDeviceFailed\", i[i.PSGParsePublicKeyForLoginFailed = 702] = \"PSGParsePublicKeyForLoginFailed\", i[i.PSGCouldNotGetUserCredential = 703] = \"PSGCouldNotGetUserCredential\", i))(y || {});\n\nvar x = new l(),\n    g = class {\n  _isLocalHost() {\n    return Boolean(window.location.hostname === \"localhost\" || window.location.hostname === \"[::1]\" || window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));\n  }\n\n  _isHttps() {\n    return location.protocol === \"https:\";\n  }\n\n  setAuthToken(e) {\n    localStorage.setItem(\"psg_auth_token\", e);\n\n    let t = !this._isHttps() && this._isLocalHost();\n\n    document.cookie = `psg_auth_token = ${e}; path=/ ${t ? \"\" : \";secure\"}`;\n  }\n\n  deleteAuthToken() {\n    localStorage.removeItem(\"psg_auth_token\"), document.cookie = \"psg_auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC;\";\n  }\n\n  async psgCredIDExists(e) {\n    let t = e.user.id,\n        n = e.handshake.challenge.publicKey.allowCredentials,\n        a = localStorage.getItem(\"psg_cred_obj\");\n    if (!a) throw new r(\"Could not get psg_cred_obj\", {\n      status: 700,\n      statusText: \"PSG Cred Object Does Not Exist\"\n    });\n    let h = JSON.parse(a)[t];\n    return n.find(I => {\n      if (x.encodeBytes(x.decodeBytes(I.id)) === x.encodeBytes(x.decodeBytes(h))) return !0;\n    });\n  }\n\n  setPsgCredID(e, t) {\n    if (!t) throw new r(\"Could not get user's credential\", {\n      status: 703,\n      statusText: \"PSG Could Not Get User Credential\"\n    });\n    let n = localStorage.getItem(\"psg_cred_obj\");\n\n    if (n) {\n      let a = JSON.parse(n);\n      a[e] = t == null ? void 0 : t.id, localStorage.setItem(\"psg_cred_obj\", JSON.stringify(a));\n    } else localStorage.setItem(\"psg_cred_obj\", JSON.stringify({\n      [e]: t == null ? void 0 : t.id\n    }));\n  }\n\n};\n\nasync function o(s) {\n  return s.ok ? s.json() : await s.text().then(e => {\n    throw new r(e, s);\n  });\n}\n\nfunction U() {\n  let s = navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1,\n      e = window.navigator.userAgent.match(/Firefox\\/([0-9]+)\\./),\n      t = e ? parseInt(e[1]) : 0;\n  return navigator.platform.indexOf(\"Win\") !== -1 && s && t === 98;\n}\n\nfunction P(s) {\n  let e = new Uint8Array(68);\n  e.set(s.slice(0, 68));\n  let t = new Uint8Array(s.byteLength - 68);\n  t.set(s.slice(68, s.byteLength));\n  let n = new Uint8Array(15),\n      a = new Uint8Array(e.byteLength + n.byteLength + t.byteLength);\n  a.set(e, 0), a.set(n, e.byteLength), a.set(t, e.byteLength + n.byteLength);\n  let h = a[30] + 15;\n  return a.set([h], 30), a;\n}\n\nvar v = new l(),\n    z = new g(),\n    O = class {\n  constructor(e, t) {\n    this.apiUrl = e + \"/register/\", this.identifier = t;\n  }\n\n  async withWebAuthn() {\n    let e = await fetch(this.apiUrl + \"webauthn/start\", {\n      body: JSON.stringify({\n        identifier: this.identifier\n      }),\n      method: \"POST\"\n    }).then(o),\n        t = await navigator.credentials.create({\n      publicKey: this._parsePublicKey(e.handshake.challenge.publicKey)\n    }).catch(w => {\n      throw new r(\"error parsing public key for webAuthn\", {\n        status: 702,\n        statusText: \"PSG Parse Public Key For Login Failed\"\n      });\n    }).then(w => w),\n        n = new Uint8Array(t == null ? void 0 : t.response.attestationObject);\n    U() && (n = P(n));\n    let a = e.user.id,\n        h = await fetch(this.apiUrl + \"webauthn/finish\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        user_id: a,\n        handshake_id: e.handshake.id,\n        handshake_response: {\n          rawId: v.encodeBytes(t == null ? void 0 : t.rawId),\n          id: t == null ? void 0 : t.id,\n          type: t == null ? void 0 : t.type,\n          response: {\n            attestationObject: v.encodeBytes(n),\n            clientDataJSON: v.encodeBytes(t == null ? void 0 : t.response.clientDataJSON)\n          }\n        }\n      })\n    }).then(o);\n    return z.setPsgCredID(a, t), h.auth_result;\n  }\n\n  _parsePublicKey(e) {\n    return e.challenge = v.decodeBytes(e.challenge.toString()), e.user.id = v.decodeBytes(e.user.id.toString()), e;\n  }\n\n};\nvar b = new l(),\n    M = new g(),\n    L = class {\n  constructor(e, t) {\n    this.apiUrl = e + \"/login/\", this.identifier = t;\n  }\n\n  async withWebAuthn() {\n    let e = await fetch(this.apiUrl + \"webauthn/start\", {\n      body: JSON.stringify({\n        identifier: this.identifier\n      }),\n      method: \"POST\"\n    }).then(o);\n    if (!(await M.psgCredIDExists(e))) throw new r(\"psg_cred_obj does not exist in the allow list\", {\n      status: 700,\n      statusText: \"psg_cred_obj does not exist in the allow list\"\n    });\n    let n = await navigator.credentials.get({\n      publicKey: this._parsePublicKey(e.handshake.challenge.publicKey)\n    }).catch(h => {\n      throw new r(\"error parsing public key for webAuthn\", {\n        status: 702,\n        statusText: \"PSG Parse Public Key For Login Failed\"\n      });\n    }).then(h => h);\n    return n ? (await fetch(this.apiUrl + \"webauthn/finish\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        user_id: e.user.id,\n        handshake_id: e.handshake.id,\n        handshake_response: {\n          id: n.id,\n          rawId: b.encodeBytes(n.rawId),\n          type: n.type,\n          response: {\n            clientDataJSON: b.encodeBytes(n.response.clientDataJSON),\n            authenticatorData: b.encodeBytes(n.response.authenticatorData),\n            signature: b.encodeBytes(n.response.signature),\n            userHandle: b.encodeBytes(n.response.userHandle)\n          }\n        }\n      })\n    }).then(o)).auth_result : {\n      auth_token: \"\",\n      redirect_url: \"\"\n    };\n  }\n\n  _parsePublicKey(e) {\n    if (e.challenge = Uint8Array.from(atob(e.challenge.toString()), t => t.charCodeAt(0)), e.allowCredentials) {\n      for (let t = 0; t < e.allowCredentials.length; t++) {\n        let n = e.allowCredentials[t];\n        n.id = b.decodeBytes(n.id.toString());\n      }\n\n      return e;\n    }\n\n    return e;\n  }\n\n};\nvar T = class {\n  constructor(e) {\n    this.apiUrl = e;\n  }\n\n  async appInfo() {\n    return (await fetch(this.apiUrl, {\n      headers: {},\n      method: \"GET\"\n    }).then(o)).app;\n  }\n\n  async identifierExists(e) {\n    return (await fetch(this.apiUrl + \"/user?identifier=\" + encodeURIComponent(e), {\n      method: \"GET\"\n    }).then(o)).user;\n  }\n\n};\nvar f = new l(),\n    H = new g(),\n    m = class {\n  constructor(e) {\n    this.apiUrl = e;\n  }\n\n  async newRegister(e) {\n    return (await fetch(this.apiUrl + \"/register/magic-link\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        identifier: e,\n        magic_link_path: window.location.pathname\n      })\n    }).then(o)).magic_link;\n  }\n\n  async newLogin(e) {\n    return (await fetch(this.apiUrl + \"/login/magic-link\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        identifier: e,\n        magic_link_path: window.location.pathname\n      })\n    }).then(o)).magic_link;\n  }\n\n  async getStatus(e) {\n    return (await fetch(this.apiUrl + \"/magic-link/status\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        id: e\n      })\n    }).then(o)).auth_result;\n  }\n\n  async activate(e) {\n    return (await fetch(this.apiUrl + \"/magic-link/activate\", {\n      method: \"PATCH\",\n      body: JSON.stringify({\n        magic_link: e\n      })\n    }).then(o)).auth_result;\n  }\n\n  async activateWebAuthnLogin(e) {\n    let t = await fetch(this.apiUrl + \"/magic-link/webauthn/login/start\", {\n      body: JSON.stringify({\n        magic_link: e\n      }),\n      method: \"POST\"\n    }).then(o);\n    if (!(await H.psgCredIDExists(t))) throw new r(\"psg_cred_obj does not exist in the allow list\", {\n      status: 700,\n      statusText: \"Not Found\"\n    });\n    let a = await navigator.credentials.get({\n      publicKey: this._parsePublicKeyLogin(t.handshake.challenge.publicKey)\n    }).catch(w => {\n      throw new r(\"could not parse publickey for login\", {\n        status: 702,\n        statusText: \"PSG Parse Public Key For Login Failed\"\n      });\n    });\n    return a ? (await fetch(this.apiUrl + \"/magic-link/webauthn/login/finish\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        magic_link: e,\n        user_id: t.user.id,\n        handshake_id: t.handshake.id,\n        handshake_response: {\n          id: a.id,\n          rawId: f.encodeBytes(a.rawId),\n          type: a.type,\n          response: {\n            clientDataJSON: f.encodeBytes(a.response.clientDataJSON),\n            authenticatorData: f.encodeBytes(a.response.authenticatorData),\n            signature: f.encodeBytes(a.response.signature),\n            userHandle: f.encodeBytes(a.response.userHandle)\n          }\n        }\n      })\n    }).then(o)).auth_result : {\n      auth_token: \"\",\n      redirect_url: \"\"\n    };\n  }\n\n  async activateWebAuthnNewDevice(e) {\n    let t = await fetch(this.apiUrl + \"/magic-link/webauthn/new/start\", {\n      body: JSON.stringify({\n        magic_link: e\n      }),\n      method: \"POST\"\n    }).then(o),\n        n = await navigator.credentials.create({\n      publicKey: this._parsePublicKeyNewDevice(t.handshake.challenge.publicKey)\n    }).catch(I => {\n      throw new r(\"could not parse public key for new device\", {\n        status: 701,\n        statusText: \"PSG Parse Public Key For New Device Failed\"\n      });\n    }),\n        a = new Uint8Array(n == null ? void 0 : n.response.attestationObject);\n    U() && (a = P(a));\n    let h = await fetch(this.apiUrl + \"/magic-link/webauthn/new/finish\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        magic_link: e,\n        user_id: t.user.id,\n        handshake_id: t.handshake.id,\n        handshake_response: {\n          rawId: f.encodeBytes(n.rawId),\n          id: n.id,\n          type: n.type,\n          response: {\n            attestationObject: f.encodeBytes(a),\n            clientDataJSON: f.encodeBytes(n.response.clientDataJSON)\n          }\n        },\n        device_name: navigator.userAgent\n      })\n    }).then(o),\n        w = t.user.id;\n    return H.setPsgCredID(w, n), h.auth_result;\n  }\n\n  _parsePublicKeyLogin(e) {\n    if (e.challenge = Uint8Array.from(atob(e.challenge.toString()), t => t.charCodeAt(0)), e.allowCredentials) {\n      for (let t = 0; t < e.allowCredentials.length; t++) {\n        let n = e.allowCredentials[t];\n        n.id = f.decodeBytes(n.id.toString());\n      }\n\n      return e;\n    }\n\n    return e;\n  }\n\n  _parsePublicKeyNewDevice(e) {\n    return e.challenge = f.decodeBytes(e.challenge.toString()), e.user.id = f.decodeBytes(e.user.id.toString()), e;\n  }\n\n};\nvar G = {\n  URL: \"https://auth.passage.id\"\n};\nvar D = G;\nimport j from \"jwt-decode\";\nvar R = new l(),\n    A,\n    p,\n    k,\n    N = class {\n  constructor(e) {\n    S(this, A, void 0);\n    S(this, p, void 0);\n    S(this, k, void 0);\n    this.userID = \"\", _(this, k, \"\"), this.authToken = e, this.authGuard(), _(this, A, \"v1\"), _(this, p, `${D.URL}/${d(this, A)}/apps/${d(this, k)}/currentuser`);\n  }\n\n  _getAuthToken() {\n    if (this.authToken !== void 0 && this.authToken !== \"\") return this.authToken;\n    if (typeof window == \"undefined\") return console.warn(\"PassageUser is failed to access localStorage. This function must be run client-side or be provided an authToken JWT.\"), \"\";\n    let e = localStorage.getItem(\"psg_auth_token\");\n    return e || \"\";\n  }\n\n  _validJWTPayload(e) {\n    let t = [\"exp\", \"iss\", \"sub\"],\n        n = Math.floor(Date.now() / 1e3);\n    return t.forEach(a => {\n      if (!(a in e)) return !1;\n    }), !(e.exp && n > e.exp);\n  }\n\n  _validJWTHeader(e) {\n    let t = {\n      alg: \"RS256\",\n      typ: \"JWT\"\n    };\n    return !(e.alg !== t.alg || e.typ !== t.typ);\n  }\n\n  authGuard() {\n    let e = this._getAuthToken();\n\n    try {\n      let t = j(e, {\n        header: !0\n      }),\n          n = j(e);\n      return n !== void 0 && t !== void 0 && this._validJWTPayload(n) && this._validJWTHeader(t) ? (this.userID = n.sub, _(this, k, n.iss), !0) : !1;\n    } catch {\n      return !1;\n    }\n  }\n\n  async userInfo() {\n    return this.authGuard() ? (await fetch(d(this, p), {\n      method: \"GET\",\n      headers: {\n        Authorization: `Bearer ${this._getAuthToken()}`\n      }\n    }).then(async t => t.status !== 200 ? void 0 : await t.json()).catch(t => {\n      throw new r(\"Failed to fetch current user.\", {\n        status: 404,\n        statusText: \"Not Found\"\n      });\n    })).user : void 0;\n  }\n\n  async changeEmail(e) {\n    if (!this.authGuard) throw new r(\"Current user is not authorized.\", {\n      status: 401,\n      statusText: \"Unauthorized\"\n    });\n    if (e === \"\" || e === void 0) throw new r(\"Current user email change could not be initiated: a new email is required.\", {\n      status: 409,\n      statusText: \"Conflict\"\n    });\n    return (await fetch(`${d(this, p)}/email`, {\n      method: \"PATCH\",\n      headers: {\n        Authorization: `Bearer ${this._getAuthToken()}`,\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        new_email: e\n      })\n    }).then(o)).magic_link;\n  }\n\n  async changePhone(e) {\n    if (!this.authGuard) throw new r(\"Current user is not authorized.\", {\n      status: 401,\n      statusText: \"Unauthorized\"\n    });\n    if (e === \"\" || e === void 0) throw new r(\"Current user phone change could not be initiated: a new phone is required.\", {\n      status: 409,\n      statusText: \"Conflict\"\n    });\n    return (await fetch(`${d(this, p)}/phone`, {\n      method: \"PATCH\",\n      headers: {\n        Authorization: `Bearer ${this._getAuthToken()}`,\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        new_phone: e\n      })\n    }).then(o)).magic_link;\n  }\n\n  async editDevice(e, t) {\n    if (!this.authGuard) throw new r(\"Current user is not authorized.\", {\n      status: 409,\n      statusText: \"Conflict\"\n    });\n    if (e === \"\" || e === void 0) throw new r(\"A deviceID is required for an edit device request.\", {\n      status: 400,\n      statusText: \"Bad Request\"\n    });\n    if (Object.keys(t).length === 0) throw new r(\"Edit device request must not have an empty request body.\", {\n      status: 400,\n      statusText: \"Bad Request\"\n    });\n    return (await fetch(`${d(this, p)}/devices/${e}`, {\n      method: \"PATCH\",\n      headers: {\n        Authorization: `Bearer ${this._getAuthToken()}`,\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(J({}, t))\n    }).then(o)).device;\n  }\n\n  async listDevices() {\n    if (!this.authGuard) throw new r(\"Current user is not authorized.\", {\n      status: 401,\n      statusText: \"Unauthorized\"\n    });\n    return (await fetch(`${d(this, p)}/devices/`, {\n      method: \"GET\",\n      headers: {\n        Authorization: `Bearer ${this._getAuthToken()}`,\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(o)).devices;\n  }\n\n  async addDevice() {\n    if (!this.authGuard()) throw new r(\"Current user is not authorized.\", {\n      status: 401,\n      statusText: \"Unauthorized\"\n    });\n    let e = await fetch(d(this, p) + \"/devices/start\", {\n      headers: {\n        Authorization: `Bearer ${this._getAuthToken()}`\n      },\n      method: \"POST\"\n    }).then(o),\n        t = await navigator.credentials.create({\n      publicKey: this._parsePublicKey(e.handshake.challenge.publicKey)\n    }).catch(h => {\n      throw new r(\"failed to parse public key\", {\n        status: 701,\n        statusText: \"PSG Parse Public Key For New Device Failed\"\n      });\n    }).then(h => h),\n        n = e.user.id;\n    return (await fetch(d(this, p) + \"/devices/finish\", {\n      headers: {\n        Authorization: `Bearer ${this._getAuthToken()}`\n      },\n      method: \"POST\",\n      body: JSON.stringify({\n        user_id: n,\n        handshake_id: e.handshake.id,\n        handshake_response: {\n          rawId: R.encodeBytes(t == null ? void 0 : t.rawId),\n          id: t == null ? void 0 : t.id,\n          type: t == null ? void 0 : t.type,\n          response: {\n            attestationObject: R.encodeBytes(t == null ? void 0 : t.response.attestationObject),\n            clientDataJSON: R.encodeBytes(t == null ? void 0 : t.response.clientDataJSON)\n          }\n        }\n      })\n    }).then(o)).device;\n  }\n\n  async deleteDevice(e) {\n    if (!this.authGuard()) throw new r(\"Current user is not authorized.\", {\n      status: 401,\n      statusText: \"Unauthorized\"\n    });\n    if (!e) throw new r(\"A deviceID is required to delete a device.\", {\n      status: 404,\n      statusText: \"Not Found\"\n    });\n    let t = !1;\n    return t = await fetch(`${d(this, p)}/devices/${e}`, {\n      method: \"DELETE\",\n      headers: {\n        Authorization: `Bearer ${this._getAuthToken()}`,\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(async n => n.ok ? !0 : await n.text().then(a => {\n      throw new r(a, n);\n    })), t;\n  }\n\n  _parsePublicKey(e) {\n    return e.challenge = R.decodeBytes(e.challenge.toString()), e.user.id = R.decodeBytes(e.user.id.toString()), e;\n  }\n\n};\nA = new WeakMap(), p = new WeakMap(), k = new WeakMap();\nvar C = class {\n  constructor(e) {\n    this.appID = e, this.baseUrl = D.URL, this.apiVersion = \"v1\", this.fullUrl = `${this.baseUrl}/${this.apiVersion}/apps/${this.appID}`;\n  }\n\n  credIDExists(e) {\n    let t = localStorage.getItem(\"psg_cred_obj\");\n    return t ? !!JSON.parse(t)[e] : !1;\n  }\n\n  setAuthToken(e) {\n    new g().setAuthToken(e);\n  }\n\n  signOut() {\n    new g().deleteAuthToken();\n  }\n\n  async register(e) {\n    return await new O(this.fullUrl, e).withWebAuthn();\n  }\n\n  async login(e) {\n    return await new L(this.fullUrl, e).withWebAuthn();\n  }\n\n  async appInfo() {\n    return await new T(this.fullUrl).appInfo();\n  }\n\n  checkWebauthnConfig(e) {\n    let t = !0;\n    return e.auth_origin.replace(/\\/$/, \"\") != window.location.origin.replace(/\\/$/, \"\") && (console.error('The auth_origin configured for webauthn in your app settings does not match the \"origin\" of your current URL.  Please reconfigure this in the admin console. (Your current \"origin\" is `' + window.location.origin + \"`) Passage will continue to work with other authentication methods.\"), t = !1), t;\n  }\n\n  async isWebauthnSupported(e) {\n    let t = !0;\n    return navigator.brave && (await navigator.brave.isBrave()) ? t = !1 : window.PublicKeyCredential ? e ? t = !0 : await window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then(n => {\n      n ? t = !0 : t = !1;\n    }).catch(n => console.log(\"Something went wrong.\")) : t = !1, t;\n  }\n\n  async identifierExists(e) {\n    return await new T(this.fullUrl).identifierExists(e);\n  }\n\n  async newRegisterMagicLink(e) {\n    return await new m(this.fullUrl).newRegister(e);\n  }\n\n  async newLoginMagicLink(e) {\n    return await new m(this.fullUrl).newLogin(e);\n  }\n\n  async magicLinkActivate(e) {\n    return await new m(this.fullUrl).activate(e);\n  }\n\n  async magicLinkActivateWebAuthnLogin(e) {\n    return await new m(this.fullUrl).activateWebAuthnLogin(e);\n  }\n\n  async magicLinkActivateWebAuthnNewDevice(e) {\n    return await new m(this.fullUrl).activateWebAuthnNewDevice(e);\n  }\n\n  async getMagicLinkStatus(e) {\n    return await new m(this.fullUrl).getStatus(e);\n  }\n\n  getCurrentUser(e) {\n    return new N(e);\n  }\n\n};\n\nvar V = (n => (n.email = \"email\", n.phone = \"phone\", n.both = \"both\", n))(V || {});\n\nvar Y = (n => (n.Active = \"active\", n.Inactive = \"inactive\", n.Pending = \"pending\", n))(Y || {});\n\nexport { V as Identifier, C as Passage, r as PassageError, y as PassageErrorCode, Y as PassageUserStatusEnum, N as User };","map":{"version":3,"sources":["G:/repos/Full Stack/bio-auth/frontend/node_modules/@passageidentity/passage-js/dist/index.js"],"names":["K","Object","defineProperty","B","getOwnPropertySymbols","$","prototype","hasOwnProperty","W","propertyIsEnumerable","F","s","e","t","enumerable","configurable","writable","value","J","call","q","has","TypeError","d","get","S","WeakSet","add","set","_","n","l","encodeBytes","btoa","String","fromCharCode","Uint8Array","replace","decodeBytes","from","atob","a","charCodeAt","r","Error","constructor","name","statusCode","status","statusText","message","_parsePsgErrorResponse","JSON","parse","error","y","i","MultipleChoice","MovedPermanantly","Found","SeeOther","NotModified","TemporaryRedirect","PermanentRedirect","BadRequest","Unauthorized","PaymentRequired","Forbidden","NotFound","MethodNotAllowed","NotAcceptable","ProxyAuthenticationRequired","RequestTimeout","Conflict","Gone","LengthRequired","PreconditionFailed","PayloadTooLarge","URITooLong","UnsupportedMediaType","RangeNotSatisfiable","ExpectationFailed","MisdirectedRequest","UnprocessableEntity","Locked","FailedDependency","TooEarly","UpgradeRequired","PreconditionRequired","TooManyRequests","RequestHeaderFieldsTooLarge","UnavailableForLegalReasons","InternalServerError","NotImplemented","BadGateway","ServiceUnavailable","GatewayTimeout","HTTPVersionNotSupported","VariantAlsoNegotiates","InsufficientStorage","LoopDetected","NotExtended","NetworkAuthenticationRequired","PSGCredObjectDoesNotExist","PSGParsePublicKeyForNewDeviceFailed","PSGParsePublicKeyForLoginFailed","PSGCouldNotGetUserCredential","x","g","_isLocalHost","Boolean","window","location","hostname","match","_isHttps","protocol","setAuthToken","localStorage","setItem","document","cookie","deleteAuthToken","removeItem","psgCredIDExists","user","id","handshake","challenge","publicKey","allowCredentials","getItem","h","find","I","setPsgCredID","stringify","o","ok","json","text","then","U","navigator","userAgent","toLowerCase","indexOf","parseInt","platform","P","slice","byteLength","v","z","O","apiUrl","identifier","withWebAuthn","fetch","body","method","credentials","create","_parsePublicKey","catch","w","response","attestationObject","user_id","handshake_id","handshake_response","rawId","type","clientDataJSON","auth_result","toString","b","M","L","authenticatorData","signature","userHandle","auth_token","redirect_url","length","T","appInfo","headers","app","identifierExists","encodeURIComponent","f","H","m","newRegister","magic_link_path","pathname","magic_link","newLogin","getStatus","activate","activateWebAuthnLogin","_parsePublicKeyLogin","activateWebAuthnNewDevice","_parsePublicKeyNewDevice","device_name","G","URL","D","j","R","A","p","k","N","userID","authToken","authGuard","_getAuthToken","console","warn","_validJWTPayload","Math","floor","Date","now","forEach","exp","_validJWTHeader","alg","typ","header","sub","iss","userInfo","Authorization","changeEmail","new_email","changePhone","new_phone","editDevice","keys","device","listDevices","devices","addDevice","deleteDevice","WeakMap","C","appID","baseUrl","apiVersion","fullUrl","credIDExists","signOut","register","login","checkWebauthnConfig","auth_origin","origin","isWebauthnSupported","brave","isBrave","PublicKeyCredential","isUserVerifyingPlatformAuthenticatorAvailable","log","newRegisterMagicLink","newLoginMagicLink","magicLinkActivate","magicLinkActivateWebAuthnLogin","magicLinkActivateWebAuthnNewDevice","getMagicLinkStatus","getCurrentUser","V","email","phone","both","Y","Active","Inactive","Pending","Identifier","Passage","PassageError","PassageErrorCode","PassageUserStatusEnum","User"],"mappings":"AAAA,IAAIA,CAAC,GAACC,MAAM,CAACC,cAAb;AAA4B,IAAIC,CAAC,GAACF,MAAM,CAACG,qBAAb;AAAmC,IAAIC,CAAC,GAACJ,MAAM,CAACK,SAAP,CAAiBC,cAAvB;AAAA,IAAsCC,CAAC,GAACP,MAAM,CAACK,SAAP,CAAiBG,oBAAzD;;AAA8E,IAAIC,CAAC,GAAC,CAACC,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAASD,CAAC,IAAID,CAAL,GAAOX,CAAC,CAACW,CAAD,EAAGC,CAAH,EAAK;AAACE,EAAAA,UAAU,EAAC,CAAC,CAAb;AAAeC,EAAAA,YAAY,EAAC,CAAC,CAA7B;AAA+BC,EAAAA,QAAQ,EAAC,CAAC,CAAzC;AAA2CC,EAAAA,KAAK,EAACJ;AAAjD,CAAL,CAAR,GAAkEF,CAAC,CAACC,CAAD,CAAD,GAAKC,CAAtF;AAAA,IAAwFK,CAAC,GAAC,CAACP,CAAD,EAAGC,CAAH,KAAO;AAAC,OAAI,IAAIC,CAAR,IAAaD,CAAC,KAAGA,CAAC,GAAC,EAAL,CAAd,EAAuBP,CAAC,CAACc,IAAF,CAAOP,CAAP,EAASC,CAAT,KAAaH,CAAC,CAACC,CAAD,EAAGE,CAAH,EAAKD,CAAC,CAACC,CAAD,CAAN,CAAd;;AAAyB,MAAGV,CAAH,EAAK,KAAI,IAAIU,CAAR,IAAaV,CAAC,CAACS,CAAD,CAAd,EAAkBJ,CAAC,CAACW,IAAF,CAAOP,CAAP,EAASC,CAAT,KAAaH,CAAC,CAACC,CAAD,EAAGE,CAAH,EAAKD,CAAC,CAACC,CAAD,CAAN,CAAd;AAAyB,SAAOF,CAAP;AAAS,CAA3M;;AAA4M,IAAIS,CAAC,GAAC,CAACT,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAAS;AAAC,MAAG,CAACD,CAAC,CAACS,GAAF,CAAMV,CAAN,CAAJ,EAAa,MAAMW,SAAS,CAAC,YAAUT,CAAX,CAAf;AAA6B,CAA1D;;AAA2D,IAAIU,CAAC,GAAC,CAACZ,CAAD,EAAGC,CAAH,EAAKC,CAAL,MAAUO,CAAC,CAACT,CAAD,EAAGC,CAAH,EAAK,yBAAL,CAAD,EAAiCC,CAAC,GAACA,CAAC,CAACM,IAAF,CAAOR,CAAP,CAAD,GAAWC,CAAC,CAACY,GAAF,CAAMb,CAAN,CAAvD,CAAN;AAAA,IAAuEc,CAAC,GAAC,CAACd,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAAS;AAAC,MAAGD,CAAC,CAACS,GAAF,CAAMV,CAAN,CAAH,EAAY,MAAMW,SAAS,CAAC,mDAAD,CAAf;AAAqEV,EAAAA,CAAC,YAAYc,OAAb,GAAqBd,CAAC,CAACe,GAAF,CAAMhB,CAAN,CAArB,GAA8BC,CAAC,CAACgB,GAAF,CAAMjB,CAAN,EAAQE,CAAR,CAA9B;AAAyC,CAA7M;AAAA,IAA8MgB,CAAC,GAAC,CAAClB,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOiB,CAAP,MAAYV,CAAC,CAACT,CAAD,EAAGC,CAAH,EAAK,wBAAL,CAAD,EAAgCkB,CAAC,GAACA,CAAC,CAACX,IAAF,CAAOR,CAAP,EAASE,CAAT,CAAD,GAAaD,CAAC,CAACgB,GAAF,CAAMjB,CAAN,EAAQE,CAAR,CAA9C,EAAyDA,CAArE,CAAhN;;AAAwR,IAAIkB,CAAC,GAAC,MAAK;AAACC,EAAAA,WAAW,CAACpB,CAAD,EAAG;AAAC,WAAOqB,IAAI,CAACC,MAAM,CAACC,YAAP,CAAoB,GAAG,IAAIC,UAAJ,CAAexB,CAAf,CAAvB,CAAD,CAAJ,CAAgDyB,OAAhD,CAAwD,KAAxD,EAA8D,GAA9D,EAAmEA,OAAnE,CAA2E,KAA3E,EAAiF,GAAjF,EAAsFA,OAAtF,CAA8F,KAA9F,EAAoG,EAApG,CAAP;AAA+G;;AAAAC,EAAAA,WAAW,CAAC1B,CAAD,EAAG;AAAC,QAAIC,CAAC,GAACD,CAAC,CAACyB,OAAF,CAAU,IAAV,EAAe,GAAf,EAAoBA,OAApB,CAA4B,IAA5B,EAAiC,GAAjC,EAAsCA,OAAtC,CAA8C,KAA9C,EAAoD,EAApD,CAAN;AAA8D,WAAOD,UAAU,CAACG,IAAX,CAAgBC,IAAI,CAAC3B,CAAD,CAApB,EAAwB4B,CAAC,IAAEA,CAAC,CAACC,UAAF,CAAa,CAAb,CAA3B,CAAP;AAAmD;;AAA/P,CAAX;;AAA4Q,IAAIC,CAAC,GAAC,cAAcC,KAAd,CAAmB;AAACC,EAAAA,WAAW,CAACjC,CAAD,EAAGC,CAAH,EAAK;AAAC;AAAQ,SAAKiC,IAAL,GAAU,cAAV,EAAyB,KAAKC,UAAL,GAAgBlC,CAAC,CAACmC,MAA3C,EAAkD,KAAKC,UAAL,GAAgBpC,CAAC,CAACoC,UAApE,EAA+E,KAAKC,OAAL,GAAa,KAAKC,sBAAL,CAA4BvC,CAA5B,CAA5F;AAA2H;;AAAAuC,EAAAA,sBAAsB,CAACvC,CAAD,EAAG;AAAC,QAAG;AAAC,aAAOA,CAAC,GAACwC,IAAI,CAACC,KAAL,CAAWzC,CAAX,CAAF,EAAgBA,CAAC,CAAC0C,KAAF,GAAQ1C,CAAC,CAAC0C,KAAV,GAAgB,EAAvC;AAA0C,KAA9C,CAA8C,MAAK;AAAC,aAAO1C,CAAP;AAAS;AAAC;;AAA7O,CAAzB;AAAA,IAAwQ2C,CAAC,GAAC,CAACC,CAAC,KAAGA,CAAC,CAACA,CAAC,CAACC,cAAF,GAAiB,GAAlB,CAAD,GAAwB,gBAAxB,EAAyCD,CAAC,CAACA,CAAC,CAACE,gBAAF,GAAmB,GAApB,CAAD,GAA0B,kBAAnE,EAAsFF,CAAC,CAACA,CAAC,CAACG,KAAF,GAAQ,GAAT,CAAD,GAAe,OAArG,EAA6GH,CAAC,CAACA,CAAC,CAACI,QAAF,GAAW,GAAZ,CAAD,GAAkB,UAA/H,EAA0IJ,CAAC,CAACA,CAAC,CAACK,WAAF,GAAc,GAAf,CAAD,GAAqB,aAA/J,EAA6KL,CAAC,CAACA,CAAC,CAACM,iBAAF,GAAoB,GAArB,CAAD,GAA2B,mBAAxM,EAA4NN,CAAC,CAACA,CAAC,CAACO,iBAAF,GAAoB,GAArB,CAAD,GAA2B,mBAAvP,EAA2QP,CAAC,CAACA,CAAC,CAACQ,UAAF,GAAa,GAAd,CAAD,GAAoB,YAA/R,EAA4SR,CAAC,CAACA,CAAC,CAACS,YAAF,GAAe,GAAhB,CAAD,GAAsB,cAAlU,EAAiVT,CAAC,CAACA,CAAC,CAACU,eAAF,GAAkB,GAAnB,CAAD,GAAyB,iBAA1W,EAA4XV,CAAC,CAACA,CAAC,CAACW,SAAF,GAAY,GAAb,CAAD,GAAmB,WAA/Y,EAA2ZX,CAAC,CAACA,CAAC,CAACY,QAAF,GAAW,GAAZ,CAAD,GAAkB,UAA7a,EAAwbZ,CAAC,CAACA,CAAC,CAACa,gBAAF,GAAmB,GAApB,CAAD,GAA0B,kBAAld,EAAqeb,CAAC,CAACA,CAAC,CAACc,aAAF,GAAgB,GAAjB,CAAD,GAAuB,eAA5f,EAA4gBd,CAAC,CAACA,CAAC,CAACe,2BAAF,GAA8B,GAA/B,CAAD,GAAqC,6BAAjjB,EAA+kBf,CAAC,CAACA,CAAC,CAACgB,cAAF,GAAiB,GAAlB,CAAD,GAAwB,gBAAvmB,EAAwnBhB,CAAC,CAACA,CAAC,CAACiB,QAAF,GAAW,GAAZ,CAAD,GAAkB,UAA1oB,EAAqpBjB,CAAC,CAACA,CAAC,CAACkB,IAAF,GAAO,GAAR,CAAD,GAAc,MAAnqB,EAA0qBlB,CAAC,CAACA,CAAC,CAACmB,cAAF,GAAiB,GAAlB,CAAD,GAAwB,gBAAlsB,EAAmtBnB,CAAC,CAACA,CAAC,CAACoB,kBAAF,GAAqB,GAAtB,CAAD,GAA4B,oBAA/uB,EAAowBpB,CAAC,CAACA,CAAC,CAACqB,eAAF,GAAkB,GAAnB,CAAD,GAAyB,iBAA7xB,EAA+yBrB,CAAC,CAACA,CAAC,CAACsB,UAAF,GAAa,GAAd,CAAD,GAAoB,YAAn0B,EAAg1BtB,CAAC,CAACA,CAAC,CAACuB,oBAAF,GAAuB,GAAxB,CAAD,GAA8B,sBAA92B,EAAq4BvB,CAAC,CAACA,CAAC,CAACwB,mBAAF,GAAsB,GAAvB,CAAD,GAA6B,qBAAl6B,EAAw7BxB,CAAC,CAACA,CAAC,CAACyB,iBAAF,GAAoB,GAArB,CAAD,GAA2B,mBAAn9B,EAAu+BzB,CAAC,CAACA,CAAC,CAAC0B,kBAAF,GAAqB,GAAtB,CAAD,GAA4B,oBAAngC,EAAwhC1B,CAAC,CAACA,CAAC,CAAC2B,mBAAF,GAAsB,GAAvB,CAAD,GAA6B,qBAArjC,EAA2kC3B,CAAC,CAACA,CAAC,CAAC4B,MAAF,GAAS,GAAV,CAAD,GAAgB,QAA3lC,EAAomC5B,CAAC,CAACA,CAAC,CAAC6B,gBAAF,GAAmB,GAApB,CAAD,GAA0B,kBAA9nC,EAAipC7B,CAAC,CAACA,CAAC,CAAC8B,QAAF,GAAW,GAAZ,CAAD,GAAkB,UAAnqC,EAA8qC9B,CAAC,CAACA,CAAC,CAAC+B,eAAF,GAAkB,GAAnB,CAAD,GAAyB,iBAAvsC,EAAytC/B,CAAC,CAACA,CAAC,CAACgC,oBAAF,GAAuB,GAAxB,CAAD,GAA8B,sBAAvvC,EAA8wChC,CAAC,CAACA,CAAC,CAACiC,eAAF,GAAkB,GAAnB,CAAD,GAAyB,iBAAvyC,EAAyzCjC,CAAC,CAACA,CAAC,CAACkC,2BAAF,GAA8B,GAA/B,CAAD,GAAqC,6BAA91C,EAA43ClC,CAAC,CAACA,CAAC,CAACmC,0BAAF,GAA6B,GAA9B,CAAD,GAAoC,4BAAh6C,EAA67CnC,CAAC,CAACA,CAAC,CAACoC,mBAAF,GAAsB,GAAvB,CAAD,GAA6B,qBAA19C,EAAg/CpC,CAAC,CAACA,CAAC,CAACqC,cAAF,GAAiB,GAAlB,CAAD,GAAwB,gBAAxgD,EAAyhDrC,CAAC,CAACA,CAAC,CAACsC,UAAF,GAAa,GAAd,CAAD,GAAoB,YAA7iD,EAA0jDtC,CAAC,CAACA,CAAC,CAACuC,kBAAF,GAAqB,GAAtB,CAAD,GAA4B,oBAAtlD,EAA2mDvC,CAAC,CAACA,CAAC,CAACwC,cAAF,GAAiB,GAAlB,CAAD,GAAwB,gBAAnoD,EAAopDxC,CAAC,CAACA,CAAC,CAACyC,uBAAF,GAA0B,GAA3B,CAAD,GAAiC,yBAArrD,EAA+sDzC,CAAC,CAACA,CAAC,CAAC0C,qBAAF,GAAwB,GAAzB,CAAD,GAA+B,uBAA9uD,EAAswD1C,CAAC,CAACA,CAAC,CAAC2C,mBAAF,GAAsB,GAAvB,CAAD,GAA6B,qBAAnyD,EAAyzD3C,CAAC,CAACA,CAAC,CAAC4C,YAAF,GAAe,GAAhB,CAAD,GAAsB,cAA/0D,EAA81D5C,CAAC,CAACA,CAAC,CAAC6C,WAAF,GAAc,GAAf,CAAD,GAAqB,aAAn3D,EAAi4D7C,CAAC,CAACA,CAAC,CAAC8C,6BAAF,GAAgC,GAAjC,CAAD,GAAuC,+BAAx6D,EAAw8D9C,CAAC,CAACA,CAAC,CAAC+C,yBAAF,GAA4B,GAA7B,CAAD,GAAmC,2BAA3+D,EAAugE/C,CAAC,CAACA,CAAC,CAACgD,mCAAF,GAAsC,GAAvC,CAAD,GAA6C,qCAApjE,EAA0lEhD,CAAC,CAACA,CAAC,CAACiD,+BAAF,GAAkC,GAAnC,CAAD,GAAyC,iCAAnoE,EAAqqEjD,CAAC,CAACA,CAAC,CAACkD,4BAAF,GAA+B,GAAhC,CAAD,GAAsC,8BAA3sE,EAA0uElD,CAA7uE,CAAF,EAAmvED,CAAC,IAAE,EAAtvE,CAA1Q;;AAAogF,IAAIoD,CAAC,GAAC,IAAI5E,CAAJ,EAAN;AAAA,IAAY6E,CAAC,GAAC,MAAK;AAACC,EAAAA,YAAY,GAAE;AAAC,WAAOC,OAAO,CAACC,MAAM,CAACC,QAAP,CAAgBC,QAAhB,KAA2B,WAA3B,IAAwCF,MAAM,CAACC,QAAP,CAAgBC,QAAhB,KAA2B,OAAnE,IAA4EF,MAAM,CAACC,QAAP,CAAgBC,QAAhB,CAAyBC,KAAzB,CAA+B,wDAA/B,CAA7E,CAAd;AAAqL;;AAAAC,EAAAA,QAAQ,GAAE;AAAC,WAAOH,QAAQ,CAACI,QAAT,KAAoB,QAA3B;AAAoC;;AAAAC,EAAAA,YAAY,CAACzG,CAAD,EAAG;AAAC0G,IAAAA,YAAY,CAACC,OAAb,CAAqB,gBAArB,EAAsC3G,CAAtC;;AAAyC,QAAIC,CAAC,GAAC,CAAC,KAAKsG,QAAL,EAAD,IAAkB,KAAKN,YAAL,EAAxB;;AAA4CW,IAAAA,QAAQ,CAACC,MAAT,GAAiB,oBAAmB7G,CAAE,YAAWC,CAAC,GAAC,EAAD,GAAI,SAAU,EAAhE;AAAkE;;AAAA6G,EAAAA,eAAe,GAAE;AAACJ,IAAAA,YAAY,CAACK,UAAb,CAAwB,gBAAxB,GAA0CH,QAAQ,CAACC,MAAT,GAAgB,yDAA1D;AAAoH;;AAAqB,QAAfG,eAAe,CAAChH,CAAD,EAAG;AAAC,QAAIC,CAAC,GAACD,CAAC,CAACiH,IAAF,CAAOC,EAAb;AAAA,QAAgBhG,CAAC,GAAClB,CAAC,CAACmH,SAAF,CAAYC,SAAZ,CAAsBC,SAAtB,CAAgCC,gBAAlD;AAAA,QAAmEzF,CAAC,GAAC6E,YAAY,CAACa,OAAb,CAAqB,cAArB,CAArE;AAA0G,QAAG,CAAC1F,CAAJ,EAAM,MAAM,IAAIE,CAAJ,CAAM,4BAAN,EAAmC;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAnC,CAAN;AAAmG,QAAImF,CAAC,GAAChF,IAAI,CAACC,KAAL,CAAWZ,CAAX,EAAc5B,CAAd,CAAN;AAAuB,WAAOiB,CAAC,CAACuG,IAAF,CAAOC,CAAC,IAAE;AAAC,UAAG3B,CAAC,CAAC3E,WAAF,CAAc2E,CAAC,CAACrE,WAAF,CAAcgG,CAAC,CAACR,EAAhB,CAAd,MAAqCnB,CAAC,CAAC3E,WAAF,CAAc2E,CAAC,CAACrE,WAAF,CAAc8F,CAAd,CAAd,CAAxC,EAAwE,OAAM,CAAC,CAAP;AAAS,KAA5F,CAAP;AAAqG;;AAAAG,EAAAA,YAAY,CAAC3H,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAG,CAACA,CAAJ,EAAM,MAAM,IAAI8B,CAAJ,CAAM,iCAAN,EAAwC;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAxC,CAAN;AAA2G,QAAInB,CAAC,GAACwF,YAAY,CAACa,OAAb,CAAqB,cAArB,CAAN;;AAA2C,QAAGrG,CAAH,EAAK;AAAC,UAAIW,CAAC,GAACW,IAAI,CAACC,KAAL,CAAWvB,CAAX,CAAN;AAAoBW,MAAAA,CAAC,CAAC7B,CAAD,CAAD,GAAKC,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACiH,EAAtB,EAAyBR,YAAY,CAACC,OAAb,CAAqB,cAArB,EAAoCnE,IAAI,CAACoF,SAAL,CAAe/F,CAAf,CAApC,CAAzB;AAAgF,KAA1G,MAA+G6E,YAAY,CAACC,OAAb,CAAqB,cAArB,EAAoCnE,IAAI,CAACoF,SAAL,CAAe;AAAC,OAAC5H,CAAD,GAAIC,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACiH;AAAtB,KAAf,CAApC;AAA+E;;AAArvC,CAAnB;;AAA0wC,eAAeW,CAAf,CAAiB9H,CAAjB,EAAmB;AAAC,SAAOA,CAAC,CAAC+H,EAAF,GAAK/H,CAAC,CAACgI,IAAF,EAAL,GAAc,MAAMhI,CAAC,CAACiI,IAAF,GAASC,IAAT,CAAcjI,CAAC,IAAE;AAAC,UAAM,IAAI+B,CAAJ,CAAM/B,CAAN,EAAQD,CAAR,CAAN;AAAiB,GAAnC,CAA3B;AAAgE;;AAAA,SAASmI,CAAT,GAAY;AAAC,MAAInI,CAAC,GAACoI,SAAS,CAACC,SAAV,CAAoBC,WAApB,GAAkCC,OAAlC,CAA0C,SAA1C,IAAqD,CAAC,CAA5D;AAAA,MAA8DtI,CAAC,GAACmG,MAAM,CAACgC,SAAP,CAAiBC,SAAjB,CAA2B9B,KAA3B,CAAiC,qBAAjC,CAAhE;AAAA,MAAwHrG,CAAC,GAACD,CAAC,GAACuI,QAAQ,CAACvI,CAAC,CAAC,CAAD,CAAF,CAAT,GAAgB,CAA3I;AAA6I,SAAOmI,SAAS,CAACK,QAAV,CAAmBF,OAAnB,CAA2B,KAA3B,MAAoC,CAAC,CAArC,IAAwCvI,CAAxC,IAA2CE,CAAC,KAAG,EAAtD;AAAyD;;AAAA,SAASwI,CAAT,CAAW1I,CAAX,EAAa;AAAC,MAAIC,CAAC,GAAC,IAAIwB,UAAJ,CAAe,EAAf,CAAN;AAAyBxB,EAAAA,CAAC,CAACgB,GAAF,CAAMjB,CAAC,CAAC2I,KAAF,CAAQ,CAAR,EAAU,EAAV,CAAN;AAAqB,MAAIzI,CAAC,GAAC,IAAIuB,UAAJ,CAAezB,CAAC,CAAC4I,UAAF,GAAa,EAA5B,CAAN;AAAsC1I,EAAAA,CAAC,CAACe,GAAF,CAAMjB,CAAC,CAAC2I,KAAF,CAAQ,EAAR,EAAW3I,CAAC,CAAC4I,UAAb,CAAN;AAAgC,MAAIzH,CAAC,GAAC,IAAIM,UAAJ,CAAe,EAAf,CAAN;AAAA,MAAyBK,CAAC,GAAC,IAAIL,UAAJ,CAAexB,CAAC,CAAC2I,UAAF,GAAazH,CAAC,CAACyH,UAAf,GAA0B1I,CAAC,CAAC0I,UAA3C,CAA3B;AAAkF9G,EAAAA,CAAC,CAACb,GAAF,CAAMhB,CAAN,EAAQ,CAAR,GAAW6B,CAAC,CAACb,GAAF,CAAME,CAAN,EAAQlB,CAAC,CAAC2I,UAAV,CAAX,EAAiC9G,CAAC,CAACb,GAAF,CAAMf,CAAN,EAAQD,CAAC,CAAC2I,UAAF,GAAazH,CAAC,CAACyH,UAAvB,CAAjC;AAAoE,MAAInB,CAAC,GAAC3F,CAAC,CAAC,EAAD,CAAD,GAAM,EAAZ;AAAe,SAAOA,CAAC,CAACb,GAAF,CAAM,CAACwG,CAAD,CAAN,EAAU,EAAV,GAAc3F,CAArB;AAAuB;;AAAA,IAAI+G,CAAC,GAAC,IAAIzH,CAAJ,EAAN;AAAA,IAAY0H,CAAC,GAAC,IAAI7C,CAAJ,EAAd;AAAA,IAAoB8C,CAAC,GAAC,MAAK;AAAC7G,EAAAA,WAAW,CAACjC,CAAD,EAAGC,CAAH,EAAK;AAAC,SAAK8I,MAAL,GAAY/I,CAAC,GAAC,YAAd,EAA2B,KAAKgJ,UAAL,GAAgB/I,CAA3C;AAA6C;;AAAkB,QAAZgJ,YAAY,GAAE;AAAC,QAAIjJ,CAAC,GAAC,MAAMkJ,KAAK,CAAC,KAAKH,MAAL,GAAY,gBAAb,EAA8B;AAACI,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAACoB,QAAAA,UAAU,EAAC,KAAKA;AAAjB,OAAf,CAAN;AAAmDI,MAAAA,MAAM,EAAC;AAA1D,KAA9B,CAAL,CAAsGnB,IAAtG,CAA2GJ,CAA3G,CAAZ;AAAA,QAA0H5H,CAAC,GAAC,MAAMkI,SAAS,CAACkB,WAAV,CAAsBC,MAAtB,CAA6B;AAACjC,MAAAA,SAAS,EAAC,KAAKkC,eAAL,CAAqBvJ,CAAC,CAACmH,SAAF,CAAYC,SAAZ,CAAsBC,SAA3C;AAAX,KAA7B,EAAgGmC,KAAhG,CAAsGC,CAAC,IAAE;AAAC,YAAM,IAAI1H,CAAJ,CAAM,uCAAN,EAA8C;AAACK,QAAAA,MAAM,EAAC,GAAR;AAAYC,QAAAA,UAAU,EAAC;AAAvB,OAA9C,CAAN;AAAqH,KAA/N,EAAiO4F,IAAjO,CAAsOwB,CAAC,IAAEA,CAAzO,CAAlI;AAAA,QAA8WvI,CAAC,GAAC,IAAIM,UAAJ,CAAevB,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACyJ,QAAF,CAAWC,iBAAzC,CAAhX;AAA4azB,IAAAA,CAAC,OAAKhH,CAAC,GAACuH,CAAC,CAACvH,CAAD,CAAR,CAAD;AAAc,QAAIW,CAAC,GAAC7B,CAAC,CAACiH,IAAF,CAAOC,EAAb;AAAA,QAAgBM,CAAC,GAAC,MAAM0B,KAAK,CAAC,KAAKH,MAAL,GAAY,iBAAb,EAA+B;AAACK,MAAAA,MAAM,EAAC,MAAR;AAAeD,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAACgC,QAAAA,OAAO,EAAC/H,CAAT;AAAWgI,QAAAA,YAAY,EAAC7J,CAAC,CAACmH,SAAF,CAAYD,EAApC;AAAuC4C,QAAAA,kBAAkB,EAAC;AAACC,UAAAA,KAAK,EAACnB,CAAC,CAACxH,WAAF,CAAcnB,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAAC8J,KAA/B,CAAP;AAA6C7C,UAAAA,EAAE,EAACjH,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACiH,EAAjE;AAAoE8C,UAAAA,IAAI,EAAC/J,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAAC+J,IAA1F;AAA+FN,UAAAA,QAAQ,EAAC;AAACC,YAAAA,iBAAiB,EAACf,CAAC,CAACxH,WAAF,CAAcF,CAAd,CAAnB;AAAoC+I,YAAAA,cAAc,EAACrB,CAAC,CAACxH,WAAF,CAAcnB,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACyJ,QAAF,CAAWO,cAAxC;AAAnD;AAAxG;AAA1D,OAAf;AAApB,KAA/B,CAAL,CAA0VhC,IAA1V,CAA+VJ,CAA/V,CAAxB;AAA0X,WAAOgB,CAAC,CAAClB,YAAF,CAAe9F,CAAf,EAAiB5B,CAAjB,GAAoBuH,CAAC,CAAC0C,WAA7B;AAAyC;;AAAAX,EAAAA,eAAe,CAACvJ,CAAD,EAAG;AAAC,WAAOA,CAAC,CAACoH,SAAF,GAAYwB,CAAC,CAAClH,WAAF,CAAc1B,CAAC,CAACoH,SAAF,CAAY+C,QAAZ,EAAd,CAAZ,EAAkDnK,CAAC,CAACiH,IAAF,CAAOC,EAAP,GAAU0B,CAAC,CAAClH,WAAF,CAAc1B,CAAC,CAACiH,IAAF,CAAOC,EAAP,CAAUiD,QAAV,EAAd,CAA5D,EAAgGnK,CAAvG;AAAyG;;AAA7iC,CAA3B;AAA0kC,IAAIoK,CAAC,GAAC,IAAIjJ,CAAJ,EAAN;AAAA,IAAYkJ,CAAC,GAAC,IAAIrE,CAAJ,EAAd;AAAA,IAAoBsE,CAAC,GAAC,MAAK;AAACrI,EAAAA,WAAW,CAACjC,CAAD,EAAGC,CAAH,EAAK;AAAC,SAAK8I,MAAL,GAAY/I,CAAC,GAAC,SAAd,EAAwB,KAAKgJ,UAAL,GAAgB/I,CAAxC;AAA0C;;AAAkB,QAAZgJ,YAAY,GAAE;AAAC,QAAIjJ,CAAC,GAAC,MAAMkJ,KAAK,CAAC,KAAKH,MAAL,GAAY,gBAAb,EAA8B;AAACI,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAACoB,QAAAA,UAAU,EAAC,KAAKA;AAAjB,OAAf,CAAN;AAAmDI,MAAAA,MAAM,EAAC;AAA1D,KAA9B,CAAL,CAAsGnB,IAAtG,CAA2GJ,CAA3G,CAAZ;AAA0H,QAAG,EAAC,MAAMwC,CAAC,CAACrD,eAAF,CAAkBhH,CAAlB,CAAP,CAAH,EAA+B,MAAM,IAAI+B,CAAJ,CAAM,+CAAN,EAAsD;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAtD,CAAN;AAAqI,QAAInB,CAAC,GAAC,MAAMiH,SAAS,CAACkB,WAAV,CAAsBzI,GAAtB,CAA0B;AAACyG,MAAAA,SAAS,EAAC,KAAKkC,eAAL,CAAqBvJ,CAAC,CAACmH,SAAF,CAAYC,SAAZ,CAAsBC,SAA3C;AAAX,KAA1B,EAA6FmC,KAA7F,CAAmGhC,CAAC,IAAE;AAAC,YAAM,IAAIzF,CAAJ,CAAM,uCAAN,EAA8C;AAACK,QAAAA,MAAM,EAAC,GAAR;AAAYC,QAAAA,UAAU,EAAC;AAAvB,OAA9C,CAAN;AAAqH,KAA5N,EAA8N4F,IAA9N,CAAmOT,CAAC,IAAEA,CAAtO,CAAZ;AAAqP,WAAOtG,CAAC,GAAC,CAAC,MAAMgI,KAAK,CAAC,KAAKH,MAAL,GAAY,iBAAb,EAA+B;AAACK,MAAAA,MAAM,EAAC,MAAR;AAAeD,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAACgC,QAAAA,OAAO,EAAC5J,CAAC,CAACiH,IAAF,CAAOC,EAAhB;AAAmB2C,QAAAA,YAAY,EAAC7J,CAAC,CAACmH,SAAF,CAAYD,EAA5C;AAA+C4C,QAAAA,kBAAkB,EAAC;AAAC5C,UAAAA,EAAE,EAAChG,CAAC,CAACgG,EAAN;AAAS6C,UAAAA,KAAK,EAACK,CAAC,CAAChJ,WAAF,CAAcF,CAAC,CAAC6I,KAAhB,CAAf;AAAsCC,UAAAA,IAAI,EAAC9I,CAAC,CAAC8I,IAA7C;AAAkDN,UAAAA,QAAQ,EAAC;AAACO,YAAAA,cAAc,EAACG,CAAC,CAAChJ,WAAF,CAAcF,CAAC,CAACwI,QAAF,CAAWO,cAAzB,CAAhB;AAAyDM,YAAAA,iBAAiB,EAACH,CAAC,CAAChJ,WAAF,CAAcF,CAAC,CAACwI,QAAF,CAAWa,iBAAzB,CAA3E;AAAuHC,YAAAA,SAAS,EAACJ,CAAC,CAAChJ,WAAF,CAAcF,CAAC,CAACwI,QAAF,CAAWc,SAAzB,CAAjI;AAAqKC,YAAAA,UAAU,EAACL,CAAC,CAAChJ,WAAF,CAAcF,CAAC,CAACwI,QAAF,CAAWe,UAAzB;AAAhL;AAA3D;AAAlE,OAAf;AAApB,KAA/B,CAAL,CAA+ZxC,IAA/Z,CAAoaJ,CAApa,CAAP,EAA+aqC,WAAhb,GAA4b;AAACQ,MAAAA,UAAU,EAAC,EAAZ;AAAeC,MAAAA,YAAY,EAAC;AAA5B,KAApc;AAAoe;;AAAApB,EAAAA,eAAe,CAACvJ,CAAD,EAAG;AAAC,QAAGA,CAAC,CAACoH,SAAF,GAAY5F,UAAU,CAACG,IAAX,CAAgBC,IAAI,CAAC5B,CAAC,CAACoH,SAAF,CAAY+C,QAAZ,EAAD,CAApB,EAA6ClK,CAAC,IAAEA,CAAC,CAAC6B,UAAF,CAAa,CAAb,CAAhD,CAAZ,EAA6E9B,CAAC,CAACsH,gBAAlF,EAAmG;AAAC,WAAI,IAAIrH,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACD,CAAC,CAACsH,gBAAF,CAAmBsD,MAAjC,EAAwC3K,CAAC,EAAzC,EAA4C;AAAC,YAAIiB,CAAC,GAAClB,CAAC,CAACsH,gBAAF,CAAmBrH,CAAnB,CAAN;AAA4BiB,QAAAA,CAAC,CAACgG,EAAF,GAAKkD,CAAC,CAAC1I,WAAF,CAAcR,CAAC,CAACgG,EAAF,CAAKiD,QAAL,EAAd,CAAL;AAAoC;;AAAA,aAAOnK,CAAP;AAAS;;AAAA,WAAOA,CAAP;AAAS;;AAA9zC,CAA3B;AAA21C,IAAI6K,CAAC,GAAC,MAAK;AAAC5I,EAAAA,WAAW,CAACjC,CAAD,EAAG;AAAC,SAAK+I,MAAL,GAAY/I,CAAZ;AAAc;;AAAa,QAAP8K,OAAO,GAAE;AAAC,WAAM,CAAC,MAAM5B,KAAK,CAAC,KAAKH,MAAN,EAAa;AAACgC,MAAAA,OAAO,EAAC,EAAT;AAAY3B,MAAAA,MAAM,EAAC;AAAnB,KAAb,CAAL,CAA6CnB,IAA7C,CAAkDJ,CAAlD,CAAP,EAA6DmD,GAAnE;AAAuE;;AAAsB,QAAhBC,gBAAgB,CAACjL,CAAD,EAAG;AAAC,WAAM,CAAC,MAAMkJ,KAAK,CAAC,KAAKH,MAAL,GAAY,mBAAZ,GAAgCmC,kBAAkB,CAAClL,CAAD,CAAnD,EAAuD;AAACoJ,MAAAA,MAAM,EAAC;AAAR,KAAvD,CAAL,CAA4EnB,IAA5E,CAAiFJ,CAAjF,CAAP,EAA4FZ,IAAlG;AAAuG;;AAAtP,CAAX;AAAmQ,IAAIkE,CAAC,GAAC,IAAIhK,CAAJ,EAAN;AAAA,IAAYiK,CAAC,GAAC,IAAIpF,CAAJ,EAAd;AAAA,IAAoBqF,CAAC,GAAC,MAAK;AAACpJ,EAAAA,WAAW,CAACjC,CAAD,EAAG;AAAC,SAAK+I,MAAL,GAAY/I,CAAZ;AAAc;;AAAiB,QAAXsL,WAAW,CAACtL,CAAD,EAAG;AAAC,WAAM,CAAC,MAAMkJ,KAAK,CAAC,KAAKH,MAAL,GAAY,sBAAb,EAAoC;AAACK,MAAAA,MAAM,EAAC,MAAR;AAAeD,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAACoB,QAAAA,UAAU,EAAChJ,CAAZ;AAAcuL,QAAAA,eAAe,EAACpF,MAAM,CAACC,QAAP,CAAgBoF;AAA9C,OAAf;AAApB,KAApC,CAAL,CAAuIvD,IAAvI,CAA4IJ,CAA5I,CAAP,EAAuJ4D,UAA7J;AAAwK;;AAAc,QAARC,QAAQ,CAAC1L,CAAD,EAAG;AAAC,WAAM,CAAC,MAAMkJ,KAAK,CAAC,KAAKH,MAAL,GAAY,mBAAb,EAAiC;AAACK,MAAAA,MAAM,EAAC,MAAR;AAAeD,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAACoB,QAAAA,UAAU,EAAChJ,CAAZ;AAAcuL,QAAAA,eAAe,EAACpF,MAAM,CAACC,QAAP,CAAgBoF;AAA9C,OAAf;AAApB,KAAjC,CAAL,CAAoIvD,IAApI,CAAyIJ,CAAzI,CAAP,EAAoJ4D,UAA1J;AAAqK;;AAAe,QAATE,SAAS,CAAC3L,CAAD,EAAG;AAAC,WAAM,CAAC,MAAMkJ,KAAK,CAAC,KAAKH,MAAL,GAAY,oBAAb,EAAkC;AAACK,MAAAA,MAAM,EAAC,MAAR;AAAeD,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAACV,QAAAA,EAAE,EAAClH;AAAJ,OAAf;AAApB,KAAlC,CAAL,CAAoFiI,IAApF,CAAyFJ,CAAzF,CAAP,EAAoGqC,WAA1G;AAAsH;;AAAc,QAAR0B,QAAQ,CAAC5L,CAAD,EAAG;AAAC,WAAM,CAAC,MAAMkJ,KAAK,CAAC,KAAKH,MAAL,GAAY,sBAAb,EAAoC;AAACK,MAAAA,MAAM,EAAC,OAAR;AAAgBD,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAAC6D,QAAAA,UAAU,EAACzL;AAAZ,OAAf;AAArB,KAApC,CAAL,CAA+FiI,IAA/F,CAAoGJ,CAApG,CAAP,EAA+GqC,WAArH;AAAiI;;AAA2B,QAArB2B,qBAAqB,CAAC7L,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC,MAAMiJ,KAAK,CAAC,KAAKH,MAAL,GAAY,kCAAb,EAAgD;AAACI,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAAC6D,QAAAA,UAAU,EAACzL;AAAZ,OAAf,CAAN;AAAqCoJ,MAAAA,MAAM,EAAC;AAA5C,KAAhD,CAAL,CAA0GnB,IAA1G,CAA+GJ,CAA/G,CAAZ;AAA8H,QAAG,EAAC,MAAMuD,CAAC,CAACpE,eAAF,CAAkB/G,CAAlB,CAAP,CAAH,EAA+B,MAAM,IAAI8B,CAAJ,CAAM,+CAAN,EAAsD;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAtD,CAAN;AAAiG,QAAIR,CAAC,GAAC,MAAMsG,SAAS,CAACkB,WAAV,CAAsBzI,GAAtB,CAA0B;AAACyG,MAAAA,SAAS,EAAC,KAAKyE,oBAAL,CAA0B7L,CAAC,CAACkH,SAAF,CAAYC,SAAZ,CAAsBC,SAAhD;AAAX,KAA1B,EAAkGmC,KAAlG,CAAwGC,CAAC,IAAE;AAAC,YAAM,IAAI1H,CAAJ,CAAM,qCAAN,EAA4C;AAACK,QAAAA,MAAM,EAAC,GAAR;AAAYC,QAAAA,UAAU,EAAC;AAAvB,OAA5C,CAAN;AAAmH,KAA/N,CAAZ;AAA6O,WAAOR,CAAC,GAAC,CAAC,MAAMqH,KAAK,CAAC,KAAKH,MAAL,GAAY,mCAAb,EAAiD;AAACK,MAAAA,MAAM,EAAC,MAAR;AAAeD,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAAC6D,QAAAA,UAAU,EAACzL,CAAZ;AAAc4J,QAAAA,OAAO,EAAC3J,CAAC,CAACgH,IAAF,CAAOC,EAA7B;AAAgC2C,QAAAA,YAAY,EAAC5J,CAAC,CAACkH,SAAF,CAAYD,EAAzD;AAA4D4C,QAAAA,kBAAkB,EAAC;AAAC5C,UAAAA,EAAE,EAACrF,CAAC,CAACqF,EAAN;AAAS6C,UAAAA,KAAK,EAACoB,CAAC,CAAC/J,WAAF,CAAcS,CAAC,CAACkI,KAAhB,CAAf;AAAsCC,UAAAA,IAAI,EAACnI,CAAC,CAACmI,IAA7C;AAAkDN,UAAAA,QAAQ,EAAC;AAACO,YAAAA,cAAc,EAACkB,CAAC,CAAC/J,WAAF,CAAcS,CAAC,CAAC6H,QAAF,CAAWO,cAAzB,CAAhB;AAAyDM,YAAAA,iBAAiB,EAACY,CAAC,CAAC/J,WAAF,CAAcS,CAAC,CAAC6H,QAAF,CAAWa,iBAAzB,CAA3E;AAAuHC,YAAAA,SAAS,EAACW,CAAC,CAAC/J,WAAF,CAAcS,CAAC,CAAC6H,QAAF,CAAWc,SAAzB,CAAjI;AAAqKC,YAAAA,UAAU,EAACU,CAAC,CAAC/J,WAAF,CAAcS,CAAC,CAAC6H,QAAF,CAAWe,UAAzB;AAAhL;AAA3D;AAA/E,OAAf;AAApB,KAAjD,CAAL,CAA8bxC,IAA9b,CAAmcJ,CAAnc,CAAP,EAA8cqC,WAA/c,GAA2d;AAACQ,MAAAA,UAAU,EAAC,EAAZ;AAAeC,MAAAA,YAAY,EAAC;AAA5B,KAAne;AAAmgB;;AAA+B,QAAzBoB,yBAAyB,CAAC/L,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC,MAAMiJ,KAAK,CAAC,KAAKH,MAAL,GAAY,gCAAb,EAA8C;AAACI,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAAC6D,QAAAA,UAAU,EAACzL;AAAZ,OAAf,CAAN;AAAqCoJ,MAAAA,MAAM,EAAC;AAA5C,KAA9C,CAAL,CAAwGnB,IAAxG,CAA6GJ,CAA7G,CAAZ;AAAA,QAA4H3G,CAAC,GAAC,MAAMiH,SAAS,CAACkB,WAAV,CAAsBC,MAAtB,CAA6B;AAACjC,MAAAA,SAAS,EAAC,KAAK2E,wBAAL,CAA8B/L,CAAC,CAACkH,SAAF,CAAYC,SAAZ,CAAsBC,SAApD;AAAX,KAA7B,EAAyGmC,KAAzG,CAA+G9B,CAAC,IAAE;AAAC,YAAM,IAAI3F,CAAJ,CAAM,2CAAN,EAAkD;AAACK,QAAAA,MAAM,EAAC,GAAR;AAAYC,QAAAA,UAAU,EAAC;AAAvB,OAAlD,CAAN;AAA8H,KAAjP,CAApI;AAAA,QAAuXR,CAAC,GAAC,IAAIL,UAAJ,CAAeN,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACwI,QAAF,CAAWC,iBAAzC,CAAzX;AAAqbzB,IAAAA,CAAC,OAAKrG,CAAC,GAAC4G,CAAC,CAAC5G,CAAD,CAAR,CAAD;AAAc,QAAI2F,CAAC,GAAC,MAAM0B,KAAK,CAAC,KAAKH,MAAL,GAAY,iCAAb,EAA+C;AAACK,MAAAA,MAAM,EAAC,MAAR;AAAeD,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAAC6D,QAAAA,UAAU,EAACzL,CAAZ;AAAc4J,QAAAA,OAAO,EAAC3J,CAAC,CAACgH,IAAF,CAAOC,EAA7B;AAAgC2C,QAAAA,YAAY,EAAC5J,CAAC,CAACkH,SAAF,CAAYD,EAAzD;AAA4D4C,QAAAA,kBAAkB,EAAC;AAACC,UAAAA,KAAK,EAACoB,CAAC,CAAC/J,WAAF,CAAcF,CAAC,CAAC6I,KAAhB,CAAP;AAA8B7C,UAAAA,EAAE,EAAChG,CAAC,CAACgG,EAAnC;AAAsC8C,UAAAA,IAAI,EAAC9I,CAAC,CAAC8I,IAA7C;AAAkDN,UAAAA,QAAQ,EAAC;AAACC,YAAAA,iBAAiB,EAACwB,CAAC,CAAC/J,WAAF,CAAcS,CAAd,CAAnB;AAAoCoI,YAAAA,cAAc,EAACkB,CAAC,CAAC/J,WAAF,CAAcF,CAAC,CAACwI,QAAF,CAAWO,cAAzB;AAAnD;AAA3D,SAA/E;AAAwOgC,QAAAA,WAAW,EAAC9D,SAAS,CAACC;AAA9P,OAAf;AAApB,KAA/C,CAAL,CAAmWH,IAAnW,CAAwWJ,CAAxW,CAAZ;AAAA,QAAuX4B,CAAC,GAACxJ,CAAC,CAACgH,IAAF,CAAOC,EAAhY;AAAmY,WAAOkE,CAAC,CAACzD,YAAF,CAAe8B,CAAf,EAAiBvI,CAAjB,GAAoBsG,CAAC,CAAC0C,WAA7B;AAAyC;;AAAA4B,EAAAA,oBAAoB,CAAC9L,CAAD,EAAG;AAAC,QAAGA,CAAC,CAACoH,SAAF,GAAY5F,UAAU,CAACG,IAAX,CAAgBC,IAAI,CAAC5B,CAAC,CAACoH,SAAF,CAAY+C,QAAZ,EAAD,CAApB,EAA6ClK,CAAC,IAAEA,CAAC,CAAC6B,UAAF,CAAa,CAAb,CAAhD,CAAZ,EAA6E9B,CAAC,CAACsH,gBAAlF,EAAmG;AAAC,WAAI,IAAIrH,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACD,CAAC,CAACsH,gBAAF,CAAmBsD,MAAjC,EAAwC3K,CAAC,EAAzC,EAA4C;AAAC,YAAIiB,CAAC,GAAClB,CAAC,CAACsH,gBAAF,CAAmBrH,CAAnB,CAAN;AAA4BiB,QAAAA,CAAC,CAACgG,EAAF,GAAKiE,CAAC,CAACzJ,WAAF,CAAcR,CAAC,CAACgG,EAAF,CAAKiD,QAAL,EAAd,CAAL;AAAoC;;AAAA,aAAOnK,CAAP;AAAS;;AAAA,WAAOA,CAAP;AAAS;;AAAAgM,EAAAA,wBAAwB,CAAChM,CAAD,EAAG;AAAC,WAAOA,CAAC,CAACoH,SAAF,GAAY+D,CAAC,CAACzJ,WAAF,CAAc1B,CAAC,CAACoH,SAAF,CAAY+C,QAAZ,EAAd,CAAZ,EAAkDnK,CAAC,CAACiH,IAAF,CAAOC,EAAP,GAAUiE,CAAC,CAACzJ,WAAF,CAAc1B,CAAC,CAACiH,IAAF,CAAOC,EAAP,CAAUiD,QAAV,EAAd,CAA5D,EAAgGnK,CAAvG;AAAyG;;AAA78F,CAA3B;AAA0+F,IAAIkM,CAAC,GAAC;AAACC,EAAAA,GAAG,EAAC;AAAL,CAAN;AAAsC,IAAIC,CAAC,GAACF,CAAN;AAAQ,OAAOG,CAAP,MAAa,YAAb;AAA0B,IAAIC,CAAC,GAAC,IAAInL,CAAJ,EAAN;AAAA,IAAYoL,CAAZ;AAAA,IAAcC,CAAd;AAAA,IAAgBC,CAAhB;AAAA,IAAkBC,CAAC,GAAC,MAAK;AAACzK,EAAAA,WAAW,CAACjC,CAAD,EAAG;AAACa,IAAAA,CAAC,CAAC,IAAD,EAAM0L,CAAN,EAAQ,KAAK,CAAb,CAAD;AAAiB1L,IAAAA,CAAC,CAAC,IAAD,EAAM2L,CAAN,EAAQ,KAAK,CAAb,CAAD;AAAiB3L,IAAAA,CAAC,CAAC,IAAD,EAAM4L,CAAN,EAAQ,KAAK,CAAb,CAAD;AAAiB,SAAKE,MAAL,GAAY,EAAZ,EAAe1L,CAAC,CAAC,IAAD,EAAMwL,CAAN,EAAQ,EAAR,CAAhB,EAA4B,KAAKG,SAAL,GAAe5M,CAA3C,EAA6C,KAAK6M,SAAL,EAA7C,EAA8D5L,CAAC,CAAC,IAAD,EAAMsL,CAAN,EAAQ,IAAR,CAA/D,EAA6EtL,CAAC,CAAC,IAAD,EAAMuL,CAAN,EAAS,GAAEJ,CAAC,CAACD,GAAI,IAAGxL,CAAC,CAAC,IAAD,EAAM4L,CAAN,CAAS,SAAQ5L,CAAC,CAAC,IAAD,EAAM8L,CAAN,CAAS,cAAhD,CAA9E;AAA6I;;AAAAK,EAAAA,aAAa,GAAE;AAAC,QAAG,KAAKF,SAAL,KAAiB,KAAK,CAAtB,IAAyB,KAAKA,SAAL,KAAiB,EAA7C,EAAgD,OAAO,KAAKA,SAAZ;AAAsB,QAAG,OAAOzG,MAAP,IAAe,WAAlB,EAA8B,OAAO4G,OAAO,CAACC,IAAR,CAAa,sHAAb,GAAqI,EAA5I;AAA+I,QAAIhN,CAAC,GAAC0G,YAAY,CAACa,OAAb,CAAqB,gBAArB,CAAN;AAA6C,WAAOvH,CAAC,IAAE,EAAV;AAAa;;AAAAiN,EAAAA,gBAAgB,CAACjN,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC,CAAC,KAAD,EAAO,KAAP,EAAa,KAAb,CAAN;AAAA,QAA0BiB,CAAC,GAACgM,IAAI,CAACC,KAAL,CAAWC,IAAI,CAACC,GAAL,KAAW,GAAtB,CAA5B;AAAuD,WAAOpN,CAAC,CAACqN,OAAF,CAAUzL,CAAC,IAAE;AAAC,UAAG,EAAEA,CAAC,IAAI7B,CAAP,CAAH,EAAa,OAAM,CAAC,CAAP;AAAS,KAApC,GAAsC,EAAEA,CAAC,CAACuN,GAAF,IAAOrM,CAAC,GAAClB,CAAC,CAACuN,GAAb,CAA7C;AAA+D;;AAAAC,EAAAA,eAAe,CAACxN,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC;AAACwN,MAAAA,GAAG,EAAC,OAAL;AAAaC,MAAAA,GAAG,EAAC;AAAjB,KAAN;AAA8B,WAAM,EAAE1N,CAAC,CAACyN,GAAF,KAAQxN,CAAC,CAACwN,GAAV,IAAezN,CAAC,CAAC0N,GAAF,KAAQzN,CAAC,CAACyN,GAA3B,CAAN;AAAsC;;AAAAb,EAAAA,SAAS,GAAE;AAAC,QAAI7M,CAAC,GAAC,KAAK8M,aAAL,EAAN;;AAA2B,QAAG;AAAC,UAAI7M,CAAC,GAACoM,CAAC,CAACrM,CAAD,EAAG;AAAC2N,QAAAA,MAAM,EAAC,CAAC;AAAT,OAAH,CAAP;AAAA,UAAuBzM,CAAC,GAACmL,CAAC,CAACrM,CAAD,CAA1B;AAA8B,aAAOkB,CAAC,KAAG,KAAK,CAAT,IAAYjB,CAAC,KAAG,KAAK,CAArB,IAAwB,KAAKgN,gBAAL,CAAsB/L,CAAtB,CAAxB,IAAkD,KAAKsM,eAAL,CAAqBvN,CAArB,CAAlD,IAA2E,KAAK0M,MAAL,GAAYzL,CAAC,CAAC0M,GAAd,EAAkB3M,CAAC,CAAC,IAAD,EAAMwL,CAAN,EAAQvL,CAAC,CAAC2M,GAAV,CAAnB,EAAkC,CAAC,CAA9G,IAAiH,CAAC,CAAzH;AAA2H,KAA7J,CAA6J,MAAK;AAAC,aAAM,CAAC,CAAP;AAAS;AAAC;;AAAc,QAARC,QAAQ,GAAE;AAAC,WAAO,KAAKjB,SAAL,KAAiB,CAAC,MAAM3D,KAAK,CAACvI,CAAC,CAAC,IAAD,EAAM6L,CAAN,CAAF,EAAW;AAACpD,MAAAA,MAAM,EAAC,KAAR;AAAc2B,MAAAA,OAAO,EAAC;AAACgD,QAAAA,aAAa,EAAE,UAAS,KAAKjB,aAAL,EAAqB;AAA9C;AAAtB,KAAX,CAAL,CAAyF7E,IAAzF,CAA8F,MAAMhI,CAAN,IAASA,CAAC,CAACmC,MAAF,KAAW,GAAX,GAAe,KAAK,CAApB,GAAsB,MAAMnC,CAAC,CAAC8H,IAAF,EAAnI,EAA6IyB,KAA7I,CAAmJvJ,CAAC,IAAE;AAAC,YAAM,IAAI8B,CAAJ,CAAM,+BAAN,EAAsC;AAACK,QAAAA,MAAM,EAAC,GAAR;AAAYC,QAAAA,UAAU,EAAC;AAAvB,OAAtC,CAAN;AAAiF,KAAxO,CAAP,EAAkP4E,IAAnQ,GAAwQ,KAAK,CAApR;AAAsR;;AAAiB,QAAX+G,WAAW,CAAChO,CAAD,EAAG;AAAC,QAAG,CAAC,KAAK6M,SAAT,EAAmB,MAAM,IAAI9K,CAAJ,CAAM,iCAAN,EAAwC;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAxC,CAAN;AAAsF,QAAGrC,CAAC,KAAG,EAAJ,IAAQA,CAAC,KAAG,KAAK,CAApB,EAAsB,MAAM,IAAI+B,CAAJ,CAAM,4EAAN,EAAmF;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAnF,CAAN;AAA6H,WAAM,CAAC,MAAM6G,KAAK,CAAE,GAAEvI,CAAC,CAAC,IAAD,EAAM6L,CAAN,CAAS,QAAd,EAAsB;AAACpD,MAAAA,MAAM,EAAC,OAAR;AAAgB2B,MAAAA,OAAO,EAAC;AAACgD,QAAAA,aAAa,EAAE,UAAS,KAAKjB,aAAL,EAAqB,EAA9C;AAAgD,wBAAe;AAA/D,OAAxB;AAA2G3D,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAACqG,QAAAA,SAAS,EAACjO;AAAX,OAAf;AAAhH,KAAtB,CAAL,CAA2KiI,IAA3K,CAAgLJ,CAAhL,CAAP,EAA2L4D,UAAjM;AAA4M;;AAAiB,QAAXyC,WAAW,CAAClO,CAAD,EAAG;AAAC,QAAG,CAAC,KAAK6M,SAAT,EAAmB,MAAM,IAAI9K,CAAJ,CAAM,iCAAN,EAAwC;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAxC,CAAN;AAAsF,QAAGrC,CAAC,KAAG,EAAJ,IAAQA,CAAC,KAAG,KAAK,CAApB,EAAsB,MAAM,IAAI+B,CAAJ,CAAM,4EAAN,EAAmF;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAnF,CAAN;AAA6H,WAAM,CAAC,MAAM6G,KAAK,CAAE,GAAEvI,CAAC,CAAC,IAAD,EAAM6L,CAAN,CAAS,QAAd,EAAsB;AAACpD,MAAAA,MAAM,EAAC,OAAR;AAAgB2B,MAAAA,OAAO,EAAC;AAACgD,QAAAA,aAAa,EAAE,UAAS,KAAKjB,aAAL,EAAqB,EAA9C;AAAgD,wBAAe;AAA/D,OAAxB;AAA2G3D,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAACuG,QAAAA,SAAS,EAACnO;AAAX,OAAf;AAAhH,KAAtB,CAAL,CAA2KiI,IAA3K,CAAgLJ,CAAhL,CAAP,EAA2L4D,UAAjM;AAA4M;;AAAgB,QAAV2C,UAAU,CAACpO,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAG,CAAC,KAAK4M,SAAT,EAAmB,MAAM,IAAI9K,CAAJ,CAAM,iCAAN,EAAwC;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAxC,CAAN;AAAkF,QAAGrC,CAAC,KAAG,EAAJ,IAAQA,CAAC,KAAG,KAAK,CAApB,EAAsB,MAAM,IAAI+B,CAAJ,CAAM,oDAAN,EAA2D;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAA3D,CAAN;AAAwG,QAAGhD,MAAM,CAACgP,IAAP,CAAYpO,CAAZ,EAAe2K,MAAf,KAAwB,CAA3B,EAA6B,MAAM,IAAI7I,CAAJ,CAAM,0DAAN,EAAiE;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAjE,CAAN;AAA8G,WAAM,CAAC,MAAM6G,KAAK,CAAE,GAAEvI,CAAC,CAAC,IAAD,EAAM6L,CAAN,CAAS,YAAWxM,CAAE,EAA3B,EAA6B;AAACoJ,MAAAA,MAAM,EAAC,OAAR;AAAgB2B,MAAAA,OAAO,EAAC;AAACgD,QAAAA,aAAa,EAAE,UAAS,KAAKjB,aAAL,EAAqB,EAA9C;AAAgD,wBAAe;AAA/D,OAAxB;AAA2G3D,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAetH,CAAC,CAAC,EAAD,EAAIL,CAAJ,CAAhB;AAAhH,KAA7B,CAAL,CAA4KgI,IAA5K,CAAiLJ,CAAjL,CAAP,EAA4LyG,MAAlM;AAAyM;;AAAiB,QAAXC,WAAW,GAAE;AAAC,QAAG,CAAC,KAAK1B,SAAT,EAAmB,MAAM,IAAI9K,CAAJ,CAAM,iCAAN,EAAwC;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAxC,CAAN;AAAsF,WAAM,CAAC,MAAM6G,KAAK,CAAE,GAAEvI,CAAC,CAAC,IAAD,EAAM6L,CAAN,CAAS,WAAd,EAAyB;AAACpD,MAAAA,MAAM,EAAC,KAAR;AAAc2B,MAAAA,OAAO,EAAC;AAACgD,QAAAA,aAAa,EAAE,UAAS,KAAKjB,aAAL,EAAqB,EAA9C;AAAgD,wBAAe;AAA/D;AAAtB,KAAzB,CAAL,CAAyI7E,IAAzI,CAA8IJ,CAA9I,CAAP,EAAyJ2G,OAA/J;AAAuK;;AAAe,QAATC,SAAS,GAAE;AAAC,QAAG,CAAC,KAAK5B,SAAL,EAAJ,EAAqB,MAAM,IAAI9K,CAAJ,CAAM,iCAAN,EAAwC;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAxC,CAAN;AAAsF,QAAIrC,CAAC,GAAC,MAAMkJ,KAAK,CAACvI,CAAC,CAAC,IAAD,EAAM6L,CAAN,CAAD,GAAU,gBAAX,EAA4B;AAACzB,MAAAA,OAAO,EAAC;AAACgD,QAAAA,aAAa,EAAE,UAAS,KAAKjB,aAAL,EAAqB;AAA9C,OAAT;AAA0D1D,MAAAA,MAAM,EAAC;AAAjE,KAA5B,CAAL,CAA2GnB,IAA3G,CAAgHJ,CAAhH,CAAZ;AAAA,QAA+H5H,CAAC,GAAC,MAAMkI,SAAS,CAACkB,WAAV,CAAsBC,MAAtB,CAA6B;AAACjC,MAAAA,SAAS,EAAC,KAAKkC,eAAL,CAAqBvJ,CAAC,CAACmH,SAAF,CAAYC,SAAZ,CAAsBC,SAA3C;AAAX,KAA7B,EAAgGmC,KAAhG,CAAsGhC,CAAC,IAAE;AAAC,YAAM,IAAIzF,CAAJ,CAAM,4BAAN,EAAmC;AAACK,QAAAA,MAAM,EAAC,GAAR;AAAYC,QAAAA,UAAU,EAAC;AAAvB,OAAnC,CAAN;AAA+G,KAAzN,EAA2N4F,IAA3N,CAAgOT,CAAC,IAAEA,CAAnO,CAAvI;AAAA,QAA6WtG,CAAC,GAAClB,CAAC,CAACiH,IAAF,CAAOC,EAAtX;AAAyX,WAAM,CAAC,MAAMgC,KAAK,CAACvI,CAAC,CAAC,IAAD,EAAM6L,CAAN,CAAD,GAAU,iBAAX,EAA6B;AAACzB,MAAAA,OAAO,EAAC;AAACgD,QAAAA,aAAa,EAAE,UAAS,KAAKjB,aAAL,EAAqB;AAA9C,OAAT;AAA0D1D,MAAAA,MAAM,EAAC,MAAjE;AAAwED,MAAAA,IAAI,EAAC3G,IAAI,CAACoF,SAAL,CAAe;AAACgC,QAAAA,OAAO,EAAC1I,CAAT;AAAW2I,QAAAA,YAAY,EAAC7J,CAAC,CAACmH,SAAF,CAAYD,EAApC;AAAuC4C,QAAAA,kBAAkB,EAAC;AAACC,UAAAA,KAAK,EAACuC,CAAC,CAAClL,WAAF,CAAcnB,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAAC8J,KAA/B,CAAP;AAA6C7C,UAAAA,EAAE,EAACjH,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACiH,EAAjE;AAAoE8C,UAAAA,IAAI,EAAC/J,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAAC+J,IAA1F;AAA+FN,UAAAA,QAAQ,EAAC;AAACC,YAAAA,iBAAiB,EAAC2C,CAAC,CAAClL,WAAF,CAAcnB,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACyJ,QAAF,CAAWC,iBAAxC,CAAnB;AAA8EM,YAAAA,cAAc,EAACqC,CAAC,CAAClL,WAAF,CAAcnB,CAAC,IAAE,IAAH,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACyJ,QAAF,CAAWO,cAAxC;AAA7F;AAAxG;AAA1D,OAAf;AAA7E,KAA7B,CAAL,CAA2bhC,IAA3b,CAAgcJ,CAAhc,CAAP,EAA2cyG,MAAjd;AAAwd;;AAAkB,QAAZI,YAAY,CAAC1O,CAAD,EAAG;AAAC,QAAG,CAAC,KAAK6M,SAAL,EAAJ,EAAqB,MAAM,IAAI9K,CAAJ,CAAM,iCAAN,EAAwC;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAxC,CAAN;AAAsF,QAAG,CAACrC,CAAJ,EAAM,MAAM,IAAI+B,CAAJ,CAAM,4CAAN,EAAmD;AAACK,MAAAA,MAAM,EAAC,GAAR;AAAYC,MAAAA,UAAU,EAAC;AAAvB,KAAnD,CAAN;AAA8F,QAAIpC,CAAC,GAAC,CAAC,CAAP;AAAS,WAAOA,CAAC,GAAC,MAAMiJ,KAAK,CAAE,GAAEvI,CAAC,CAAC,IAAD,EAAM6L,CAAN,CAAS,YAAWxM,CAAE,EAA3B,EAA6B;AAACoJ,MAAAA,MAAM,EAAC,QAAR;AAAiB2B,MAAAA,OAAO,EAAC;AAACgD,QAAAA,aAAa,EAAE,UAAS,KAAKjB,aAAL,EAAqB,EAA9C;AAAgD,wBAAe;AAA/D;AAAzB,KAA7B,CAAL,CAAgJ7E,IAAhJ,CAAqJ,MAAM/G,CAAN,IAASA,CAAC,CAAC4G,EAAF,GAAK,CAAC,CAAN,GAAQ,MAAM5G,CAAC,CAAC8G,IAAF,GAASC,IAAT,CAAcpG,CAAC,IAAE;AAAC,YAAM,IAAIE,CAAJ,CAAMF,CAAN,EAAQX,CAAR,CAAN;AAAiB,KAAnC,CAA5K,CAAR,EAA0NjB,CAAjO;AAAmO;;AAAAsJ,EAAAA,eAAe,CAACvJ,CAAD,EAAG;AAAC,WAAOA,CAAC,CAACoH,SAAF,GAAYkF,CAAC,CAAC5K,WAAF,CAAc1B,CAAC,CAACoH,SAAF,CAAY+C,QAAZ,EAAd,CAAZ,EAAkDnK,CAAC,CAACiH,IAAF,CAAOC,EAAP,GAAUoF,CAAC,CAAC5K,WAAF,CAAc1B,CAAC,CAACiH,IAAF,CAAOC,EAAP,CAAUiD,QAAV,EAAd,CAA5D,EAAgGnK,CAAvG;AAAyG;;AAA/iJ,CAAzB;AAA0kJuM,CAAC,GAAC,IAAIoC,OAAJ,EAAF,EAAcnC,CAAC,GAAC,IAAImC,OAAJ,EAAhB,EAA4BlC,CAAC,GAAC,IAAIkC,OAAJ,EAA9B;AAA0C,IAAIC,CAAC,GAAC,MAAK;AAAC3M,EAAAA,WAAW,CAACjC,CAAD,EAAG;AAAC,SAAK6O,KAAL,GAAW7O,CAAX,EAAa,KAAK8O,OAAL,GAAa1C,CAAC,CAACD,GAA5B,EAAgC,KAAK4C,UAAL,GAAgB,IAAhD,EAAqD,KAAKC,OAAL,GAAc,GAAE,KAAKF,OAAQ,IAAG,KAAKC,UAAW,SAAQ,KAAKF,KAAM,EAAxH;AAA0H;;AAAAI,EAAAA,YAAY,CAACjP,CAAD,EAAG;AAAC,QAAIC,CAAC,GAACyG,YAAY,CAACa,OAAb,CAAqB,cAArB,CAAN;AAA2C,WAAOtH,CAAC,GAAC,CAAC,CAACuC,IAAI,CAACC,KAAL,CAAWxC,CAAX,EAAcD,CAAd,CAAH,GAAoB,CAAC,CAA7B;AAA+B;;AAAAyG,EAAAA,YAAY,CAACzG,CAAD,EAAG;AAAC,QAAIgG,CAAJ,GAAQS,YAAR,CAAqBzG,CAArB;AAAwB;;AAAAkP,EAAAA,OAAO,GAAE;AAAC,QAAIlJ,CAAJ,GAAQc,eAAR;AAA0B;;AAAc,QAARqI,QAAQ,CAACnP,CAAD,EAAG;AAAC,WAAO,MAAM,IAAI8I,CAAJ,CAAM,KAAKkG,OAAX,EAAmBhP,CAAnB,EAAsBiJ,YAAtB,EAAb;AAAkD;;AAAW,QAALmG,KAAK,CAACpP,CAAD,EAAG;AAAC,WAAO,MAAM,IAAIsK,CAAJ,CAAM,KAAK0E,OAAX,EAAmBhP,CAAnB,EAAsBiJ,YAAtB,EAAb;AAAkD;;AAAa,QAAP6B,OAAO,GAAE;AAAC,WAAO,MAAM,IAAID,CAAJ,CAAM,KAAKmE,OAAX,EAAoBlE,OAApB,EAAb;AAA2C;;AAAAuE,EAAAA,mBAAmB,CAACrP,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC,CAAC,CAAP;AAAS,WAAOD,CAAC,CAACsP,WAAF,CAAc7N,OAAd,CAAsB,KAAtB,EAA4B,EAA5B,KAAiC0E,MAAM,CAACC,QAAP,CAAgBmJ,MAAhB,CAAuB9N,OAAvB,CAA+B,KAA/B,EAAqC,EAArC,CAAjC,KAA4EsL,OAAO,CAACrK,KAAR,CAAc,6LAA2LyD,MAAM,CAACC,QAAP,CAAgBmJ,MAA3M,GAAkN,qEAAhO,GAAuStP,CAAC,GAAC,CAAC,CAAtX,GAAyXA,CAAhY;AAAkY;;AAAyB,QAAnBuP,mBAAmB,CAACxP,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC,CAAC,CAAP;AAAS,WAAOkI,SAAS,CAACsH,KAAV,KAAiB,MAAMtH,SAAS,CAACsH,KAAV,CAAgBC,OAAhB,EAAvB,IAAiDzP,CAAC,GAAC,CAAC,CAApD,GAAsDkG,MAAM,CAACwJ,mBAAP,GAA2B3P,CAAC,GAACC,CAAC,GAAC,CAAC,CAAJ,GAAM,MAAMkG,MAAM,CAACwJ,mBAAP,CAA2BC,6CAA3B,GAA2E3H,IAA3E,CAAgF/G,CAAC,IAAE;AAACA,MAAAA,CAAC,GAACjB,CAAC,GAAC,CAAC,CAAJ,GAAMA,CAAC,GAAC,CAAC,CAAV;AAAY,KAAhG,EAAkGuJ,KAAlG,CAAwGtI,CAAC,IAAE6L,OAAO,CAAC8C,GAAR,CAAY,uBAAZ,CAA3G,CAAxC,GAAyL5P,CAAC,GAAC,CAAC,CAAlP,EAAoPA,CAA3P;AAA6P;;AAAsB,QAAhBgL,gBAAgB,CAACjL,CAAD,EAAG;AAAC,WAAO,MAAM,IAAI6K,CAAJ,CAAM,KAAKmE,OAAX,EAAoB/D,gBAApB,CAAqCjL,CAArC,CAAb;AAAqD;;AAA0B,QAApB8P,oBAAoB,CAAC9P,CAAD,EAAG;AAAC,WAAO,MAAM,IAAIqL,CAAJ,CAAM,KAAK2D,OAAX,EAAoB1D,WAApB,CAAgCtL,CAAhC,CAAb;AAAgD;;AAAuB,QAAjB+P,iBAAiB,CAAC/P,CAAD,EAAG;AAAC,WAAO,MAAM,IAAIqL,CAAJ,CAAM,KAAK2D,OAAX,EAAoBtD,QAApB,CAA6B1L,CAA7B,CAAb;AAA6C;;AAAuB,QAAjBgQ,iBAAiB,CAAChQ,CAAD,EAAG;AAAC,WAAO,MAAM,IAAIqL,CAAJ,CAAM,KAAK2D,OAAX,EAAoBpD,QAApB,CAA6B5L,CAA7B,CAAb;AAA6C;;AAAoC,QAA9BiQ,8BAA8B,CAACjQ,CAAD,EAAG;AAAC,WAAO,MAAM,IAAIqL,CAAJ,CAAM,KAAK2D,OAAX,EAAoBnD,qBAApB,CAA0C7L,CAA1C,CAAb;AAA0D;;AAAwC,QAAlCkQ,kCAAkC,CAAClQ,CAAD,EAAG;AAAC,WAAO,MAAM,IAAIqL,CAAJ,CAAM,KAAK2D,OAAX,EAAoBjD,yBAApB,CAA8C/L,CAA9C,CAAb;AAA8D;;AAAwB,QAAlBmQ,kBAAkB,CAACnQ,CAAD,EAAG;AAAC,WAAO,MAAM,IAAIqL,CAAJ,CAAM,KAAK2D,OAAX,EAAoBrD,SAApB,CAA8B3L,CAA9B,CAAb;AAA8C;;AAAAoQ,EAAAA,cAAc,CAACpQ,CAAD,EAAG;AAAC,WAAO,IAAI0M,CAAJ,CAAM1M,CAAN,CAAP;AAAgB;;AAA1xD,CAAX;;AAAuyD,IAAIqQ,CAAC,GAAC,CAACnP,CAAC,KAAGA,CAAC,CAACoP,KAAF,GAAQ,OAAR,EAAgBpP,CAAC,CAACqP,KAAF,GAAQ,OAAxB,EAAgCrP,CAAC,CAACsP,IAAF,GAAO,MAAvC,EAA8CtP,CAAjD,CAAF,EAAuDmP,CAAC,IAAE,EAA1D,CAAN;;AAAoE,IAAII,CAAC,GAAC,CAACvP,CAAC,KAAGA,CAAC,CAACwP,MAAF,GAAS,QAAT,EAAkBxP,CAAC,CAACyP,QAAF,GAAW,UAA7B,EAAwCzP,CAAC,CAAC0P,OAAF,GAAU,SAAlD,EAA4D1P,CAA/D,CAAF,EAAqEuP,CAAC,IAAE,EAAxE,CAAN;;AAAkF,SAAOJ,CAAC,IAAIQ,UAAZ,EAAuBjC,CAAC,IAAIkC,OAA5B,EAAoC/O,CAAC,IAAIgP,YAAzC,EAAsDpO,CAAC,IAAIqO,gBAA3D,EAA4EP,CAAC,IAAIQ,qBAAjF,EAAuGvE,CAAC,IAAIwE,IAA5G","sourcesContent":["var K=Object.defineProperty;var B=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var F=(s,e,t)=>e in s?K(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,J=(s,e)=>{for(var t in e||(e={}))$.call(e,t)&&F(s,t,e[t]);if(B)for(var t of B(e))W.call(e,t)&&F(s,t,e[t]);return s};var q=(s,e,t)=>{if(!e.has(s))throw TypeError(\"Cannot \"+t)};var d=(s,e,t)=>(q(s,e,\"read from private field\"),t?t.call(s):e.get(s)),S=(s,e,t)=>{if(e.has(s))throw TypeError(\"Cannot add the same private member more than once\");e instanceof WeakSet?e.add(s):e.set(s,t)},_=(s,e,t,n)=>(q(s,e,\"write to private field\"),n?n.call(s,t):e.set(s,t),t);var l=class{encodeBytes(e){return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\\+/g,\"-\").replace(/\\//g,\"_\").replace(/=+$/,\"\")}decodeBytes(e){let t=e.replace(/-/g,\"+\").replace(/_/g,\"/\").replace(/=+$/,\"\");return Uint8Array.from(atob(t),a=>a.charCodeAt(0))}};var r=class extends Error{constructor(e,t){super();this.name=\"PassageError\",this.statusCode=t.status,this.statusText=t.statusText,this.message=this._parsePsgErrorResponse(e)}_parsePsgErrorResponse(e){try{return e=JSON.parse(e),e.error?e.error:\"\"}catch{return e}}},y=(i=>(i[i.MultipleChoice=300]=\"MultipleChoice\",i[i.MovedPermanantly=301]=\"MovedPermanantly\",i[i.Found=302]=\"Found\",i[i.SeeOther=303]=\"SeeOther\",i[i.NotModified=304]=\"NotModified\",i[i.TemporaryRedirect=307]=\"TemporaryRedirect\",i[i.PermanentRedirect=308]=\"PermanentRedirect\",i[i.BadRequest=400]=\"BadRequest\",i[i.Unauthorized=401]=\"Unauthorized\",i[i.PaymentRequired=402]=\"PaymentRequired\",i[i.Forbidden=403]=\"Forbidden\",i[i.NotFound=404]=\"NotFound\",i[i.MethodNotAllowed=405]=\"MethodNotAllowed\",i[i.NotAcceptable=406]=\"NotAcceptable\",i[i.ProxyAuthenticationRequired=407]=\"ProxyAuthenticationRequired\",i[i.RequestTimeout=408]=\"RequestTimeout\",i[i.Conflict=409]=\"Conflict\",i[i.Gone=410]=\"Gone\",i[i.LengthRequired=411]=\"LengthRequired\",i[i.PreconditionFailed=412]=\"PreconditionFailed\",i[i.PayloadTooLarge=413]=\"PayloadTooLarge\",i[i.URITooLong=414]=\"URITooLong\",i[i.UnsupportedMediaType=415]=\"UnsupportedMediaType\",i[i.RangeNotSatisfiable=416]=\"RangeNotSatisfiable\",i[i.ExpectationFailed=417]=\"ExpectationFailed\",i[i.MisdirectedRequest=421]=\"MisdirectedRequest\",i[i.UnprocessableEntity=422]=\"UnprocessableEntity\",i[i.Locked=423]=\"Locked\",i[i.FailedDependency=424]=\"FailedDependency\",i[i.TooEarly=425]=\"TooEarly\",i[i.UpgradeRequired=426]=\"UpgradeRequired\",i[i.PreconditionRequired=428]=\"PreconditionRequired\",i[i.TooManyRequests=429]=\"TooManyRequests\",i[i.RequestHeaderFieldsTooLarge=431]=\"RequestHeaderFieldsTooLarge\",i[i.UnavailableForLegalReasons=451]=\"UnavailableForLegalReasons\",i[i.InternalServerError=500]=\"InternalServerError\",i[i.NotImplemented=501]=\"NotImplemented\",i[i.BadGateway=502]=\"BadGateway\",i[i.ServiceUnavailable=503]=\"ServiceUnavailable\",i[i.GatewayTimeout=504]=\"GatewayTimeout\",i[i.HTTPVersionNotSupported=505]=\"HTTPVersionNotSupported\",i[i.VariantAlsoNegotiates=506]=\"VariantAlsoNegotiates\",i[i.InsufficientStorage=507]=\"InsufficientStorage\",i[i.LoopDetected=508]=\"LoopDetected\",i[i.NotExtended=510]=\"NotExtended\",i[i.NetworkAuthenticationRequired=511]=\"NetworkAuthenticationRequired\",i[i.PSGCredObjectDoesNotExist=700]=\"PSGCredObjectDoesNotExist\",i[i.PSGParsePublicKeyForNewDeviceFailed=701]=\"PSGParsePublicKeyForNewDeviceFailed\",i[i.PSGParsePublicKeyForLoginFailed=702]=\"PSGParsePublicKeyForLoginFailed\",i[i.PSGCouldNotGetUserCredential=703]=\"PSGCouldNotGetUserCredential\",i))(y||{});var x=new l,g=class{_isLocalHost(){return Boolean(window.location.hostname===\"localhost\"||window.location.hostname===\"[::1]\"||window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))}_isHttps(){return location.protocol===\"https:\"}setAuthToken(e){localStorage.setItem(\"psg_auth_token\",e);let t=!this._isHttps()&&this._isLocalHost();document.cookie=`psg_auth_token = ${e}; path=/ ${t?\"\":\";secure\"}`}deleteAuthToken(){localStorage.removeItem(\"psg_auth_token\"),document.cookie=\"psg_auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC;\"}async psgCredIDExists(e){let t=e.user.id,n=e.handshake.challenge.publicKey.allowCredentials,a=localStorage.getItem(\"psg_cred_obj\");if(!a)throw new r(\"Could not get psg_cred_obj\",{status:700,statusText:\"PSG Cred Object Does Not Exist\"});let h=JSON.parse(a)[t];return n.find(I=>{if(x.encodeBytes(x.decodeBytes(I.id))===x.encodeBytes(x.decodeBytes(h)))return!0})}setPsgCredID(e,t){if(!t)throw new r(\"Could not get user's credential\",{status:703,statusText:\"PSG Could Not Get User Credential\"});let n=localStorage.getItem(\"psg_cred_obj\");if(n){let a=JSON.parse(n);a[e]=t==null?void 0:t.id,localStorage.setItem(\"psg_cred_obj\",JSON.stringify(a))}else localStorage.setItem(\"psg_cred_obj\",JSON.stringify({[e]:t==null?void 0:t.id}))}};async function o(s){return s.ok?s.json():await s.text().then(e=>{throw new r(e,s)})}function U(){let s=navigator.userAgent.toLowerCase().indexOf(\"firefox\")>-1,e=window.navigator.userAgent.match(/Firefox\\/([0-9]+)\\./),t=e?parseInt(e[1]):0;return navigator.platform.indexOf(\"Win\")!==-1&&s&&t===98}function P(s){let e=new Uint8Array(68);e.set(s.slice(0,68));let t=new Uint8Array(s.byteLength-68);t.set(s.slice(68,s.byteLength));let n=new Uint8Array(15),a=new Uint8Array(e.byteLength+n.byteLength+t.byteLength);a.set(e,0),a.set(n,e.byteLength),a.set(t,e.byteLength+n.byteLength);let h=a[30]+15;return a.set([h],30),a}var v=new l,z=new g,O=class{constructor(e,t){this.apiUrl=e+\"/register/\",this.identifier=t}async withWebAuthn(){let e=await fetch(this.apiUrl+\"webauthn/start\",{body:JSON.stringify({identifier:this.identifier}),method:\"POST\"}).then(o),t=await navigator.credentials.create({publicKey:this._parsePublicKey(e.handshake.challenge.publicKey)}).catch(w=>{throw new r(\"error parsing public key for webAuthn\",{status:702,statusText:\"PSG Parse Public Key For Login Failed\"})}).then(w=>w),n=new Uint8Array(t==null?void 0:t.response.attestationObject);U()&&(n=P(n));let a=e.user.id,h=await fetch(this.apiUrl+\"webauthn/finish\",{method:\"POST\",body:JSON.stringify({user_id:a,handshake_id:e.handshake.id,handshake_response:{rawId:v.encodeBytes(t==null?void 0:t.rawId),id:t==null?void 0:t.id,type:t==null?void 0:t.type,response:{attestationObject:v.encodeBytes(n),clientDataJSON:v.encodeBytes(t==null?void 0:t.response.clientDataJSON)}}})}).then(o);return z.setPsgCredID(a,t),h.auth_result}_parsePublicKey(e){return e.challenge=v.decodeBytes(e.challenge.toString()),e.user.id=v.decodeBytes(e.user.id.toString()),e}};var b=new l,M=new g,L=class{constructor(e,t){this.apiUrl=e+\"/login/\",this.identifier=t}async withWebAuthn(){let e=await fetch(this.apiUrl+\"webauthn/start\",{body:JSON.stringify({identifier:this.identifier}),method:\"POST\"}).then(o);if(!await M.psgCredIDExists(e))throw new r(\"psg_cred_obj does not exist in the allow list\",{status:700,statusText:\"psg_cred_obj does not exist in the allow list\"});let n=await navigator.credentials.get({publicKey:this._parsePublicKey(e.handshake.challenge.publicKey)}).catch(h=>{throw new r(\"error parsing public key for webAuthn\",{status:702,statusText:\"PSG Parse Public Key For Login Failed\"})}).then(h=>h);return n?(await fetch(this.apiUrl+\"webauthn/finish\",{method:\"POST\",body:JSON.stringify({user_id:e.user.id,handshake_id:e.handshake.id,handshake_response:{id:n.id,rawId:b.encodeBytes(n.rawId),type:n.type,response:{clientDataJSON:b.encodeBytes(n.response.clientDataJSON),authenticatorData:b.encodeBytes(n.response.authenticatorData),signature:b.encodeBytes(n.response.signature),userHandle:b.encodeBytes(n.response.userHandle)}}})}).then(o)).auth_result:{auth_token:\"\",redirect_url:\"\"}}_parsePublicKey(e){if(e.challenge=Uint8Array.from(atob(e.challenge.toString()),t=>t.charCodeAt(0)),e.allowCredentials){for(let t=0;t<e.allowCredentials.length;t++){let n=e.allowCredentials[t];n.id=b.decodeBytes(n.id.toString())}return e}return e}};var T=class{constructor(e){this.apiUrl=e}async appInfo(){return(await fetch(this.apiUrl,{headers:{},method:\"GET\"}).then(o)).app}async identifierExists(e){return(await fetch(this.apiUrl+\"/user?identifier=\"+encodeURIComponent(e),{method:\"GET\"}).then(o)).user}};var f=new l,H=new g,m=class{constructor(e){this.apiUrl=e}async newRegister(e){return(await fetch(this.apiUrl+\"/register/magic-link\",{method:\"POST\",body:JSON.stringify({identifier:e,magic_link_path:window.location.pathname})}).then(o)).magic_link}async newLogin(e){return(await fetch(this.apiUrl+\"/login/magic-link\",{method:\"POST\",body:JSON.stringify({identifier:e,magic_link_path:window.location.pathname})}).then(o)).magic_link}async getStatus(e){return(await fetch(this.apiUrl+\"/magic-link/status\",{method:\"POST\",body:JSON.stringify({id:e})}).then(o)).auth_result}async activate(e){return(await fetch(this.apiUrl+\"/magic-link/activate\",{method:\"PATCH\",body:JSON.stringify({magic_link:e})}).then(o)).auth_result}async activateWebAuthnLogin(e){let t=await fetch(this.apiUrl+\"/magic-link/webauthn/login/start\",{body:JSON.stringify({magic_link:e}),method:\"POST\"}).then(o);if(!await H.psgCredIDExists(t))throw new r(\"psg_cred_obj does not exist in the allow list\",{status:700,statusText:\"Not Found\"});let a=await navigator.credentials.get({publicKey:this._parsePublicKeyLogin(t.handshake.challenge.publicKey)}).catch(w=>{throw new r(\"could not parse publickey for login\",{status:702,statusText:\"PSG Parse Public Key For Login Failed\"})});return a?(await fetch(this.apiUrl+\"/magic-link/webauthn/login/finish\",{method:\"POST\",body:JSON.stringify({magic_link:e,user_id:t.user.id,handshake_id:t.handshake.id,handshake_response:{id:a.id,rawId:f.encodeBytes(a.rawId),type:a.type,response:{clientDataJSON:f.encodeBytes(a.response.clientDataJSON),authenticatorData:f.encodeBytes(a.response.authenticatorData),signature:f.encodeBytes(a.response.signature),userHandle:f.encodeBytes(a.response.userHandle)}}})}).then(o)).auth_result:{auth_token:\"\",redirect_url:\"\"}}async activateWebAuthnNewDevice(e){let t=await fetch(this.apiUrl+\"/magic-link/webauthn/new/start\",{body:JSON.stringify({magic_link:e}),method:\"POST\"}).then(o),n=await navigator.credentials.create({publicKey:this._parsePublicKeyNewDevice(t.handshake.challenge.publicKey)}).catch(I=>{throw new r(\"could not parse public key for new device\",{status:701,statusText:\"PSG Parse Public Key For New Device Failed\"})}),a=new Uint8Array(n==null?void 0:n.response.attestationObject);U()&&(a=P(a));let h=await fetch(this.apiUrl+\"/magic-link/webauthn/new/finish\",{method:\"POST\",body:JSON.stringify({magic_link:e,user_id:t.user.id,handshake_id:t.handshake.id,handshake_response:{rawId:f.encodeBytes(n.rawId),id:n.id,type:n.type,response:{attestationObject:f.encodeBytes(a),clientDataJSON:f.encodeBytes(n.response.clientDataJSON)}},device_name:navigator.userAgent})}).then(o),w=t.user.id;return H.setPsgCredID(w,n),h.auth_result}_parsePublicKeyLogin(e){if(e.challenge=Uint8Array.from(atob(e.challenge.toString()),t=>t.charCodeAt(0)),e.allowCredentials){for(let t=0;t<e.allowCredentials.length;t++){let n=e.allowCredentials[t];n.id=f.decodeBytes(n.id.toString())}return e}return e}_parsePublicKeyNewDevice(e){return e.challenge=f.decodeBytes(e.challenge.toString()),e.user.id=f.decodeBytes(e.user.id.toString()),e}};var G={URL:\"https://auth.passage.id\"};var D=G;import j from\"jwt-decode\";var R=new l,A,p,k,N=class{constructor(e){S(this,A,void 0);S(this,p,void 0);S(this,k,void 0);this.userID=\"\",_(this,k,\"\"),this.authToken=e,this.authGuard(),_(this,A,\"v1\"),_(this,p,`${D.URL}/${d(this,A)}/apps/${d(this,k)}/currentuser`)}_getAuthToken(){if(this.authToken!==void 0&&this.authToken!==\"\")return this.authToken;if(typeof window==\"undefined\")return console.warn(\"PassageUser is failed to access localStorage. This function must be run client-side or be provided an authToken JWT.\"),\"\";let e=localStorage.getItem(\"psg_auth_token\");return e||\"\"}_validJWTPayload(e){let t=[\"exp\",\"iss\",\"sub\"],n=Math.floor(Date.now()/1e3);return t.forEach(a=>{if(!(a in e))return!1}),!(e.exp&&n>e.exp)}_validJWTHeader(e){let t={alg:\"RS256\",typ:\"JWT\"};return!(e.alg!==t.alg||e.typ!==t.typ)}authGuard(){let e=this._getAuthToken();try{let t=j(e,{header:!0}),n=j(e);return n!==void 0&&t!==void 0&&this._validJWTPayload(n)&&this._validJWTHeader(t)?(this.userID=n.sub,_(this,k,n.iss),!0):!1}catch{return!1}}async userInfo(){return this.authGuard()?(await fetch(d(this,p),{method:\"GET\",headers:{Authorization:`Bearer ${this._getAuthToken()}`}}).then(async t=>t.status!==200?void 0:await t.json()).catch(t=>{throw new r(\"Failed to fetch current user.\",{status:404,statusText:\"Not Found\"})})).user:void 0}async changeEmail(e){if(!this.authGuard)throw new r(\"Current user is not authorized.\",{status:401,statusText:\"Unauthorized\"});if(e===\"\"||e===void 0)throw new r(\"Current user email change could not be initiated: a new email is required.\",{status:409,statusText:\"Conflict\"});return(await fetch(`${d(this,p)}/email`,{method:\"PATCH\",headers:{Authorization:`Bearer ${this._getAuthToken()}`,\"Content-Type\":\"application/json\"},body:JSON.stringify({new_email:e})}).then(o)).magic_link}async changePhone(e){if(!this.authGuard)throw new r(\"Current user is not authorized.\",{status:401,statusText:\"Unauthorized\"});if(e===\"\"||e===void 0)throw new r(\"Current user phone change could not be initiated: a new phone is required.\",{status:409,statusText:\"Conflict\"});return(await fetch(`${d(this,p)}/phone`,{method:\"PATCH\",headers:{Authorization:`Bearer ${this._getAuthToken()}`,\"Content-Type\":\"application/json\"},body:JSON.stringify({new_phone:e})}).then(o)).magic_link}async editDevice(e,t){if(!this.authGuard)throw new r(\"Current user is not authorized.\",{status:409,statusText:\"Conflict\"});if(e===\"\"||e===void 0)throw new r(\"A deviceID is required for an edit device request.\",{status:400,statusText:\"Bad Request\"});if(Object.keys(t).length===0)throw new r(\"Edit device request must not have an empty request body.\",{status:400,statusText:\"Bad Request\"});return(await fetch(`${d(this,p)}/devices/${e}`,{method:\"PATCH\",headers:{Authorization:`Bearer ${this._getAuthToken()}`,\"Content-Type\":\"application/json\"},body:JSON.stringify(J({},t))}).then(o)).device}async listDevices(){if(!this.authGuard)throw new r(\"Current user is not authorized.\",{status:401,statusText:\"Unauthorized\"});return(await fetch(`${d(this,p)}/devices/`,{method:\"GET\",headers:{Authorization:`Bearer ${this._getAuthToken()}`,\"Content-Type\":\"application/json\"}}).then(o)).devices}async addDevice(){if(!this.authGuard())throw new r(\"Current user is not authorized.\",{status:401,statusText:\"Unauthorized\"});let e=await fetch(d(this,p)+\"/devices/start\",{headers:{Authorization:`Bearer ${this._getAuthToken()}`},method:\"POST\"}).then(o),t=await navigator.credentials.create({publicKey:this._parsePublicKey(e.handshake.challenge.publicKey)}).catch(h=>{throw new r(\"failed to parse public key\",{status:701,statusText:\"PSG Parse Public Key For New Device Failed\"})}).then(h=>h),n=e.user.id;return(await fetch(d(this,p)+\"/devices/finish\",{headers:{Authorization:`Bearer ${this._getAuthToken()}`},method:\"POST\",body:JSON.stringify({user_id:n,handshake_id:e.handshake.id,handshake_response:{rawId:R.encodeBytes(t==null?void 0:t.rawId),id:t==null?void 0:t.id,type:t==null?void 0:t.type,response:{attestationObject:R.encodeBytes(t==null?void 0:t.response.attestationObject),clientDataJSON:R.encodeBytes(t==null?void 0:t.response.clientDataJSON)}}})}).then(o)).device}async deleteDevice(e){if(!this.authGuard())throw new r(\"Current user is not authorized.\",{status:401,statusText:\"Unauthorized\"});if(!e)throw new r(\"A deviceID is required to delete a device.\",{status:404,statusText:\"Not Found\"});let t=!1;return t=await fetch(`${d(this,p)}/devices/${e}`,{method:\"DELETE\",headers:{Authorization:`Bearer ${this._getAuthToken()}`,\"Content-Type\":\"application/json\"}}).then(async n=>n.ok?!0:await n.text().then(a=>{throw new r(a,n)})),t}_parsePublicKey(e){return e.challenge=R.decodeBytes(e.challenge.toString()),e.user.id=R.decodeBytes(e.user.id.toString()),e}};A=new WeakMap,p=new WeakMap,k=new WeakMap;var C=class{constructor(e){this.appID=e,this.baseUrl=D.URL,this.apiVersion=\"v1\",this.fullUrl=`${this.baseUrl}/${this.apiVersion}/apps/${this.appID}`}credIDExists(e){let t=localStorage.getItem(\"psg_cred_obj\");return t?!!JSON.parse(t)[e]:!1}setAuthToken(e){new g().setAuthToken(e)}signOut(){new g().deleteAuthToken()}async register(e){return await new O(this.fullUrl,e).withWebAuthn()}async login(e){return await new L(this.fullUrl,e).withWebAuthn()}async appInfo(){return await new T(this.fullUrl).appInfo()}checkWebauthnConfig(e){let t=!0;return e.auth_origin.replace(/\\/$/,\"\")!=window.location.origin.replace(/\\/$/,\"\")&&(console.error('The auth_origin configured for webauthn in your app settings does not match the \"origin\" of your current URL.  Please reconfigure this in the admin console. (Your current \"origin\" is `'+window.location.origin+\"`) Passage will continue to work with other authentication methods.\"),t=!1),t}async isWebauthnSupported(e){let t=!0;return navigator.brave&&await navigator.brave.isBrave()?t=!1:window.PublicKeyCredential?e?t=!0:await window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then(n=>{n?t=!0:t=!1}).catch(n=>console.log(\"Something went wrong.\")):t=!1,t}async identifierExists(e){return await new T(this.fullUrl).identifierExists(e)}async newRegisterMagicLink(e){return await new m(this.fullUrl).newRegister(e)}async newLoginMagicLink(e){return await new m(this.fullUrl).newLogin(e)}async magicLinkActivate(e){return await new m(this.fullUrl).activate(e)}async magicLinkActivateWebAuthnLogin(e){return await new m(this.fullUrl).activateWebAuthnLogin(e)}async magicLinkActivateWebAuthnNewDevice(e){return await new m(this.fullUrl).activateWebAuthnNewDevice(e)}async getMagicLinkStatus(e){return await new m(this.fullUrl).getStatus(e)}getCurrentUser(e){return new N(e)}};var V=(n=>(n.email=\"email\",n.phone=\"phone\",n.both=\"both\",n))(V||{});var Y=(n=>(n.Active=\"active\",n.Inactive=\"inactive\",n.Pending=\"pending\",n))(Y||{});export{V as Identifier,C as Passage,r as PassageError,y as PassageErrorCode,Y as PassageUserStatusEnum,N as User};\n"]},"metadata":{},"sourceType":"module"}